"use strict";(globalThis.webpackChunkdocumentation=globalThis.webpackChunkdocumentation||[]).push([[6442],{8237:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>m,frontMatter:()=>o,metadata:()=>i,toc:()=>t});const i=JSON.parse('{"id":"ocolecionadorclassifier","title":"OColecionadorClassifier","description":"\ud83d\udccb Vis\xe3o Geral","source":"@site/docs/ocolecionadorclassifier.md","sourceDirName":".","slug":"/ocolecionadorclassifier","permalink":"/OColecionador/docs/ocolecionadorclassifier","draft":false,"unlisted":false,"editUrl":"https://github.com/PatrickCalorioCarvalho/OColecionador/edit/main/Documentation/docs/docs/ocolecionadorclassifier.md","tags":[],"version":"current","frontMatter":{"id":"ocolecionadorclassifier","title":"OColecionadorClassifier","sidebar_label":"Introdu\xe7\xe3o"},"sidebar":"docs","previous":{"title":"Avan\xe7ado","permalink":"/OColecionador/docs/ocolecionadoraugmentations-advanced"},"next":{"title":"Avan\xe7ado","permalink":"/OColecionador/docs/ocolecionadorclassifier-advanced"}}');var s=r(4848),a=r(8453);const o={id:"ocolecionadorclassifier",title:"OColecionadorClassifier",sidebar_label:"Introdu\xe7\xe3o"},d="OColecionadorClassifier \ud83e\udd16",l={},t=[{value:"\ud83d\udccb Vis\xe3o Geral",id:"-vis\xe3o-geral",level:2},{value:"Responsabilidades Principais",id:"responsabilidades-principais",level:3},{value:"\ud83c\udfd7\ufe0f Arquitetura",id:"\ufe0f-arquitetura",level:2},{value:"Estrutura de Pastas",id:"estrutura-de-pastas",level:3},{value:"\ud83d\udce6 Depend\xeancias Principais",id:"-depend\xeancias-principais",level:2},{value:"\ud83d\udd0c Fluxo Principal",id:"-fluxo-principal",level:2},{value:"\ud83e\udde0 Arquitetura do Modelo",id:"-arquitetura-do-modelo",level:2},{value:"MobileNetV2 (Transfer Learning)",id:"mobilenetv2-transfer-learning",level:3},{value:"Extra\xe7\xe3o de Embeddings (Layer anterior \xe0 sa\xedda)",id:"extra\xe7\xe3o-de-embeddings-layer-anterior-\xe0-sa\xedda",level:3},{value:"\ud83d\udd0c Endpoints REST",id:"-endpoints-rest",level:2},{value:"1. <strong>POST /api/classify</strong>",id:"1-post-apiclassify",level:3},{value:"2. <strong>POST /api/classify/batch</strong>",id:"2-post-apiclassifybatch",level:3},{value:"3. <strong>POST /api/classify/similarity</strong>",id:"3-post-apiclassifysimilarity",level:3},{value:"4. <strong>GET /api/model/status</strong>",id:"4-get-apimodelstatus",level:3},{value:"5. <strong>GET /api/model/classes</strong>",id:"5-get-apimodelclasses",level:3},{value:"6. <strong>POST /api/model/update</strong>",id:"6-post-apimodelupdate",level:3},{value:"\ud83d\uddc4\ufe0f Estrutura de Dados PostgreSQL",id:"\ufe0f-estrutura-de-dados-postgresql",level:2},{value:"Tabela: predictions",id:"tabela-predictions",level:3},{value:"Tabela: model_metrics",id:"tabela-model_metrics",level:3},{value:"Tabela: inference_logs",id:"tabela-inference_logs",level:3},{value:"\ud83d\udd27 Configura\xe7\xe3o",id:"-configura\xe7\xe3o",level:2},{value:"Vari\xe1veis de Ambiente (.env)",id:"vari\xe1veis-de-ambiente-env",level:3},{value:"\ud83d\ude80 Estrutura de C\xf3digo (app.py)",id:"-estrutura-de-c\xf3digo-apppy",level:2},{value:"\ud83d\udc33 Docker",id:"-docker",level:2},{value:"Dockerfile",id:"dockerfile",level:3},{value:"requirements.txt",id:"requirementstxt",level:3},{value:"\ud83d\udd04 Fluxo Completo: Upload \u2192 Classifica\xe7\xe3o \u2192 Similaridade",id:"-fluxo-completo-upload--classifica\xe7\xe3o--similaridade",level:2},{value:"\u26a1 Performance",id:"-performance",level:2},{value:"\ud83c\udfaf Conclus\xe3o",id:"-conclus\xe3o",level:2}];function c(e){const n={br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"ocolecionadorclassifier-",children:"OColecionadorClassifier \ud83e\udd16"})}),"\n",(0,s.jsx)(n.h2,{id:"-vis\xe3o-geral",children:"\ud83d\udccb Vis\xe3o Geral"}),"\n",(0,s.jsxs)(n.p,{children:["O ",(0,s.jsx)(n.strong,{children:"OColecionadorClassifier"})," \xe9 um servi\xe7o Python de ",(0,s.jsx)(n.strong,{children:"infer\xeancia de modelos de Deep Learning"})," que classifica imagens de colecion\xe1veis. Ele funciona como um ",(0,s.jsx)(n.strong,{children:"servidor Flask/FastAPI"})," que:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\ud83d\udd0d ",(0,s.jsx)(n.strong,{children:"Recebe requisi\xe7\xf5es HTTP"})," com imagens"]}),"\n",(0,s.jsxs)(n.li,{children:["\ud83e\udde0 ",(0,s.jsx)(n.strong,{children:"Executa infer\xeancia TensorFlow"})," (MobileNetV2)"]}),"\n",(0,s.jsxs)(n.li,{children:["\ud83c\udfaf ",(0,s.jsx)(n.strong,{children:"Retorna classifica\xe7\xe3o e confian\xe7a"})]}),"\n",(0,s.jsxs)(n.li,{children:["\ud83d\udd17 ",(0,s.jsx)(n.strong,{children:"Extrai embeddings"})," para busca de similaridade via FAISS"]}),"\n",(0,s.jsxs)(n.li,{children:["\ud83d\udcca ",(0,s.jsx)(n.strong,{children:"Integra com banco de dados"})," para rastreamento"]}),"\n",(0,s.jsxs)(n.li,{children:["\u26a1 ",(0,s.jsx)(n.strong,{children:"Oferece presigned URLs"})," do MinIO"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"responsabilidades-principais",children:"Responsabilidades Principais"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\ud83c\udf10 ",(0,s.jsx)(n.strong,{children:"API REST"})," \u2013 Endpoints para classifica\xe7\xe3o"]}),"\n",(0,s.jsxs)(n.li,{children:["\ud83e\udde0 ",(0,s.jsx)(n.strong,{children:"Infer\xeancia TensorFlow"})," \u2013 Forward pass em modelos treinados"]}),"\n",(0,s.jsxs)(n.li,{children:["\ud83d\udd0d ",(0,s.jsx)(n.strong,{children:"Busca de Similaridade"})," \u2013 FAISS para encontrar itens similares"]}),"\n",(0,s.jsxs)(n.li,{children:["\ud83d\udcbe ",(0,s.jsx)(n.strong,{children:"Persist\xeancia"})," \u2013 Registra predi\xe7\xf5es no PostgreSQL"]}),"\n",(0,s.jsxs)(n.li,{children:["\ud83d\udce5 ",(0,s.jsx)(n.strong,{children:"Gerenciamento de Modelos"})," \u2013 Carrega e atualiza modelos"]}),"\n",(0,s.jsxs)(n.li,{children:["\ud83c\udfb2 ",(0,s.jsx)(n.strong,{children:"Batch Inference"})," \u2013 Processa m\xfaltiplas imagens"]}),"\n",(0,s.jsxs)(n.li,{children:["\ud83d\udd10 ",(0,s.jsx)(n.strong,{children:"Valida\xe7\xe3o de Entrada"})," \u2013 Valida formato e tamanho de imagens"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"\ufe0f-arquitetura",children:"\ud83c\udfd7\ufe0f Arquitetura"}),"\n",(0,s.jsx)(n.h3,{id:"estrutura-de-pastas",children:"Estrutura de Pastas"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"OColecionadorClassifier/\r\n\u251c\u2500\u2500 app.py                        # Ponto de entrada Flask/FastAPI\r\n\u251c\u2500\u2500 requirements.txt              # Depend\xeancias Python\r\n\u251c\u2500\u2500 Dockerfile                    # Imagem Docker\r\n\u251c\u2500\u2500 init_db.sql                  # Schema PostgreSQL\r\n\u251c\u2500\u2500 models/                       # Diret\xf3rio de modelos\r\n\u2502   \u251c\u2500\u2500 v1/\r\n\u2502   \u2502   \u251c\u2500\u2500 model.h5            # Modelo TensorFlow\r\n\u2502   \u2502   \u251c\u2500\u2500 embeddings.faiss    # \xcdndice FAISS\r\n\u2502   \u2502   \u2514\u2500\u2500 metadata.json       # Metadados do modelo\r\n\u2502   \u2514\u2500\u2500 v2/\r\n\u2502       \u251c\u2500\u2500 model.h5\r\n\u2502       \u251c\u2500\u2500 embeddings.faiss\r\n\u2502       \u2514\u2500\u2500 metadata.json\r\n\u251c\u2500\u2500 [m\xf3dulos Python esperados]\r\n\u2502   \u251c\u2500\u2500 config.py               # Configura\xe7\xf5es\r\n\u2502   \u251c\u2500\u2500 model_loader.py         # Carrega modelos\r\n\u2502   \u251c\u2500\u2500 inference_engine.py     # Motor de infer\xeancia\r\n\u2502   \u251c\u2500\u2500 minio_handler.py        # Handler MinIO\r\n\u2502   \u251c\u2500\u2500 database.py             # Conex\xe3o PostgreSQL\r\n\u2502   \u251c\u2500\u2500 validators.py           # Valida\xe7\xe3o de entrada\r\n\u2502   \u2514\u2500\u2500 logger.py               # Logging centralizado\r\n\u2514\u2500\u2500 tests/\r\n    \u251c\u2500\u2500 test_inference.py\r\n    \u251c\u2500\u2500 test_api.py\r\n    \u2514\u2500\u2500 test_faiss.py\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"-depend\xeancias-principais",children:"\ud83d\udce6 Depend\xeancias Principais"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-txt",children:"Python 3.11+\r\n\u251c\u2500\u2500 flask                    # Web framework\r\n\u251c\u2500\u2500 tensorflow               # Deep learning framework\r\n\u251c\u2500\u2500 numpy                    # Computa\xe7\xe3o num\xe9rica\r\n\u251c\u2500\u2500 pillow                   # Processamento de imagens\r\n\u251c\u2500\u2500 opencv-python           # Vis\xe3o computacional\r\n\u251c\u2500\u2500 faiss-cpu               # Busca de similaridade\r\n\u251c\u2500\u2500 psycopg2-binary         # PostgreSQL Client\r\n\u251c\u2500\u2500 minio                   # MinIO/S3 Client\r\n\u251c\u2500\u2500 python-dotenv           # Vari\xe1veis de ambiente\r\n\u251c\u2500\u2500 gunicorn                # WSGI server\r\n\u2514\u2500\u2500 requests                # HTTP client\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"-fluxo-principal",children:"\ud83d\udd0c Fluxo Principal"}),"\n",(0,s.jsx)(n.mermaid,{value:'graph LR\r\n    A["\ud83d\udcf1 Frontend/Mobile"] --\x3e|POST /classify| B["\ud83e\udd16 Classifier API"]\r\n    B --\x3e|Download| C["\ud83d\udce6 MinIO"]\r\n    B --\x3e|Load| D["\ud83e\udde0 TensorFlow Model"]\r\n    D --\x3e|Infer| E["\ud83c\udfaf Softmax Output"]\r\n    E --\x3e|Extract| F["\ud83d\udd17 Embeddings"]\r\n    F --\x3e|Search| G["\ud83d\udd0d FAISS Index"]\r\n    G --\x3e|Query| H["\ud83d\udcbe PostgreSQL"]\r\n    H --\x3e|Found| I["\ud83d\udcca Similar Items"]\r\n    B --\x3e|Return| A'}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"-arquitetura-do-modelo",children:"\ud83e\udde0 Arquitetura do Modelo"}),"\n",(0,s.jsx)(n.h3,{id:"mobilenetv2-transfer-learning",children:"MobileNetV2 (Transfer Learning)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Input: 224x224x3 (RGB)\r\n    \u2193\r\n[Conv2D + BatchNorm + ReLU] \xd7 N layers\r\n    \u2193\r\nGlobal Average Pooling\r\n    \u2193\r\nDense(512, activation='relu')\r\n    \u2193\r\nDropout(0.5)\r\n    \u2193\r\nDense(num_classes, activation='softmax')\r\n    \u2193\r\nOutput: [prob_classe1, prob_classe2, ..., prob_classeN]\n"})}),"\n",(0,s.jsx)(n.h3,{id:"extra\xe7\xe3o-de-embeddings-layer-anterior-\xe0-sa\xedda",children:"Extra\xe7\xe3o de Embeddings (Layer anterior \xe0 sa\xedda)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Input: 224x224x3\r\n    \u2193\r\n[MobileNetV2 features]\r\n    \u2193\r\nGlobal Average Pooling \u2192 1280D vector\r\n    \u2193\r\nDense(512) \u2192 512D embedding\r\n    \u2193\r\nL2 Normalization\r\n    \u2193\r\nOutput: [e1, e2, ..., e512] (para FAISS)\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"-endpoints-rest",children:"\ud83d\udd0c Endpoints REST"}),"\n",(0,s.jsxs)(n.h3,{id:"1-post-apiclassify",children:["1. ",(0,s.jsx)(n.strong,{children:"POST /api/classify"})]}),"\n",(0,s.jsx)(n.p,{children:"Classifica uma imagem \xfanica."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Request:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\r\n  "image": <FormData File>,\r\n  "top_k": 3\r\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Response:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\r\n  "classe": "carro",\r\n  "confianca": 0.92,\r\n  "classe_numerica": 5,\r\n  "top_k_predictions": [\r\n    { "classe": "carro", "confianca": 0.92 },\r\n    { "classe": "lamborghini", "confianca": 0.07 },\r\n    { "classe": "veiculo", "confianca": 0.01 }\r\n  ],\r\n  "embedding": [0.12, -0.34, 0.56, ...], // 512D\r\n  "inference_time_ms": 145,\r\n  "model_version": "v2_20251115"\r\n}\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.h3,{id:"2-post-apiclassifybatch",children:["2. ",(0,s.jsx)(n.strong,{children:"POST /api/classify/batch"})]}),"\n",(0,s.jsx)(n.p,{children:"Classifica m\xfaltiplas imagens (batch)."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Request:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\r\n  "images": [<File>, <File>, <File>],\r\n  "top_k": 1\r\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Response:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\r\n  "results": [\r\n    {\r\n      "image_id": "1",\r\n      "classe": "carro",\r\n      "confianca": 0.92,\r\n      "embedding": [...]\r\n    },\r\n    {\r\n      "image_id": "2",\r\n      "classe": "moeda",\r\n      "confianca": 0.88,\r\n      "embedding": [...]\r\n    }\r\n  ],\r\n  "total_time_ms": 420,\r\n  "model_version": "v2"\r\n}\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.h3,{id:"3-post-apiclassifysimilarity",children:["3. ",(0,s.jsx)(n.strong,{children:"POST /api/classify/similarity"})]}),"\n",(0,s.jsx)(n.p,{children:"Encontra itens similares usando FAISS."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Request:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\r\n  "embedding": [0.12, -0.34, 0.56, ...], // 512D\r\n  "k": 5,\r\n  "threshold": 0.7\r\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Response:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\r\n  "similar_items": [\r\n    {\r\n      "item_id": 101,\r\n      "nome": "Ferrari 250",\r\n      "distancia": 0.08,\r\n      "confianca_similaridade": 0.92,\r\n      "foto_url": "https://minio.../item/101/original.jpg"\r\n    },\r\n    {\r\n      "item_id": 102,\r\n      "nome": "Ferrari 275",\r\n      "distancia": 0.12,\r\n      "confianca_similaridade": 0.88,\r\n      "foto_url": "https://minio.../item/102/original.jpg"\r\n    }\r\n  ],\r\n  "search_time_ms": 45,\r\n  "total_found": 5\r\n}\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.h3,{id:"4-get-apimodelstatus",children:["4. ",(0,s.jsx)(n.strong,{children:"GET /api/model/status"})]}),"\n",(0,s.jsx)(n.p,{children:"Retorna status do modelo atual."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Response:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\r\n  "model_version": "v2_20251115",\r\n  "status": "loaded",\r\n  "accuracy": 0.94,\r\n  "total_classes": 50,\r\n  "input_shape": [224, 224, 3],\r\n  "faiss_index_size": 5000,\r\n  "last_updated": "2025-11-15T14:30:00Z",\r\n  "model_path": "models/v2/model.h5"\r\n}\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.h3,{id:"5-get-apimodelclasses",children:["5. ",(0,s.jsx)(n.strong,{children:"GET /api/model/classes"})]}),"\n",(0,s.jsx)(n.p,{children:"Lista todas as classes treinadas."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Response:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\r\n  "total_classes": 50,\r\n  "classes": [\r\n    { "id": 0, "name": "carro" },\r\n    { "id": 1, "name": "lamborghini" },\r\n    { "id": 2, "name": "ferrari" },\r\n    { "id": 3, "name": "moeda" },\r\n    ...\r\n  ],\r\n  "model_version": "v2"\r\n}\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.h3,{id:"6-post-apimodelupdate",children:["6. ",(0,s.jsx)(n.strong,{children:"POST /api/model/update"})]}),"\n",(0,s.jsx)(n.p,{children:"Atualiza o modelo carregado em mem\xf3ria."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Request:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\r\n  "model_path": "models/v3/model.h5",\r\n  "embeddings_path": "models/v3/embeddings.faiss"\r\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Response:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\r\n  "status": "success",\r\n  "message": "Model v3 loaded successfully",\r\n  "previous_version": "v2",\r\n  "new_version": "v3"\r\n}\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"\ufe0f-estrutura-de-dados-postgresql",children:"\ud83d\uddc4\ufe0f Estrutura de Dados PostgreSQL"}),"\n",(0,s.jsx)(n.h3,{id:"tabela-predictions",children:"Tabela: predictions"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE predictions (\r\n    id SERIAL PRIMARY KEY,\r\n    image_path VARCHAR(255) NOT NULL,\r\n    classe VARCHAR(100) NOT NULL,\r\n    classe_numerica INT,\r\n    confianca DECIMAL(5, 4),\r\n    embedding BYTEA, -- Armazena array NumPy serializado\r\n    inference_time_ms INT,\r\n    model_version VARCHAR(50),\r\n    item_id INT REFERENCES items(id),\r\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\r\n);\n"})}),"\n",(0,s.jsx)(n.h3,{id:"tabela-model_metrics",children:"Tabela: model_metrics"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE model_metrics (\r\n    id SERIAL PRIMARY KEY,\r\n    model_version VARCHAR(50) UNIQUE,\r\n    accuracy DECIMAL(5, 4),\r\n    precision DECIMAL(5, 4),\r\n    recall DECIMAL(5, 4),\r\n    f1_score DECIMAL(5, 4),\r\n    total_classes INT,\r\n    total_training_samples INT,\r\n    inference_time_avg_ms DECIMAL(6, 2),\r\n    faiss_index_size INT,\r\n    trained_at TIMESTAMP,\r\n    loaded_at TIMESTAMP,\r\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\r\n);\n"})}),"\n",(0,s.jsx)(n.h3,{id:"tabela-inference_logs",children:"Tabela: inference_logs"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE inference_logs (\r\n    id SERIAL PRIMARY KEY,\r\n    request_id VARCHAR(36),\r\n    image_hash VARCHAR(64),\r\n    predicted_class VARCHAR(100),\r\n    confidence DECIMAL(5, 4),\r\n    top_k_predictions JSON,\r\n    inference_time_ms INT,\r\n    model_version VARCHAR(50),\r\n    user_id INT,\r\n    status VARCHAR(20), -- success, error, timeout\r\n    error_message TEXT,\r\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\r\n);\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"-configura\xe7\xe3o",children:"\ud83d\udd27 Configura\xe7\xe3o"}),"\n",(0,s.jsx)(n.h3,{id:"vari\xe1veis-de-ambiente-env",children:"Vari\xe1veis de Ambiente (.env)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Flask/API\r\nFLASK_ENV=production\r\nFLASK_PORT=5001\r\nWORKERS=4\r\nTIMEOUT=30\r\n\r\n# Modelos TensorFlow\r\nMODEL_PATH=./models/v2/model.h5\r\nEMBEDDINGS_PATH=./models/v2/embeddings.faiss\r\nMODEL_VERSION=v2_20251115\r\nINPUT_SIZE=224\r\n\r\n# MinIO\r\nMINIO_HOST=minio\r\nMINIO_PORT=9000\r\nMINIO_ACCESS_KEY=OColecionadorUser\r\nMINIO_SECRET_KEY=OColecionador@2025\r\nMINIO_BUCKET_ORIGINAL=ocolecionadorbucket-original\r\n\r\n# PostgreSQL\r\nDB_HOST=postgres\r\nDB_PORT=5432\r\nDB_NAME=classifier_db\r\nDB_USER=OColecionadorUser\r\nDB_PASSWORD=OColecionador@2025\r\n\r\n# FAISS\r\nFAISS_INDEX_TYPE=IVFFlat  # IVFFlat, HNSW, Flat\r\nFAISS_METRIC=L2  # L2, IP (Inner Product)\r\nFAISS_NPROBE=10\r\n\r\n# Logging\r\nLOG_LEVEL=INFO\r\nLOG_FILE=/logs/classifier.log\r\n\r\n# Inference\r\nBATCH_SIZE=32\r\nMAX_IMAGE_SIZE_MB=10\r\nCONFIDENCE_THRESHOLD=0.5\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"-estrutura-de-c\xf3digo-apppy",children:"\ud83d\ude80 Estrutura de C\xf3digo (app.py)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"# app.py - Ponto de entrada\r\n\r\nfrom flask import Flask, request, jsonify\r\nimport tensorflow as tf\r\nimport faiss\r\nimport numpy as np\r\nfrom PIL import Image\r\nimport psycopg2\r\nimport logging\r\nfrom datetime import datetime\r\n\r\napp = Flask(__name__)\r\n\r\n# Carregar modelo TensorFlow\r\nmodel = tf.keras.models.load_model(MODEL_PATH)\r\nembedding_model = tf.keras.Model(inputs=model.input, outputs=model.layers[-2].output)\r\n\r\n# Carregar \xedndice FAISS\r\nfaiss_index = faiss.read_index(EMBEDDINGS_PATH)\r\n\r\n# Conex\xe3o PostgreSQL\r\ndb_connection = psycopg2.connect(...)\r\n\r\n@app.route('/api/classify', methods=['POST'])\r\ndef classify():\r\n    \"\"\"Classifica uma imagem\"\"\"\r\n    try:\r\n        # 1. Validar input\r\n        if 'image' not in request.files:\r\n            return jsonify({'error': 'Imagem n\xe3o fornecida'}), 400\r\n        \r\n        image_file = request.files['image']\r\n        \r\n        # 2. Carregar e pr\xe9-processar imagem\r\n        image = Image.open(image_file).convert('RGB')\r\n        image = image.resize((224, 224))\r\n        image_array = np.array(image) / 255.0\r\n        image_array = np.expand_dims(image_array, axis=0)\r\n        \r\n        # 3. Infer\xeancia\r\n        start_time = time.time()\r\n        predictions = model.predict(image_array)\r\n        inference_time = (time.time() - start_time) * 1000\r\n        \r\n        # 4. Extrair embedding\r\n        embeddings = embedding_model.predict(image_array)\r\n        embedding = embeddings[0].astype('float32')\r\n        \r\n        # 5. Top-K predi\xe7\xf5es\r\n        top_k = request.args.get('top_k', 3, type=int)\r\n        top_indices = np.argsort(predictions[0])[-top_k:][::-1]\r\n        \r\n        result = {\r\n            'classe': CLASS_NAMES[top_indices[0]],\r\n            'confianca': float(predictions[0][top_indices[0]]),\r\n            'top_k_predictions': [\r\n                {\r\n                    'classe': CLASS_NAMES[idx],\r\n                    'confianca': float(predictions[0][idx])\r\n                }\r\n                for idx in top_indices\r\n            ],\r\n            'embedding': embedding.tolist(),\r\n            'inference_time_ms': round(inference_time, 2),\r\n            'model_version': MODEL_VERSION\r\n        }\r\n        \r\n        # 6. Registrar no banco\r\n        save_prediction(result, image_file.filename)\r\n        \r\n        return jsonify(result), 200\r\n        \r\n    except Exception as e:\r\n        logging.error(f\"Erro na classifica\xe7\xe3o: {str(e)}\")\r\n        return jsonify({'error': str(e)}), 500\r\n\r\n\r\n@app.route('/api/classify/similarity', methods=['POST'])\r\ndef find_similarity():\r\n    \"\"\"Busca itens similares via FAISS\"\"\"\r\n    try:\r\n        data = request.get_json()\r\n        embedding = np.array(data['embedding']).reshape(1, -1).astype('float32')\r\n        k = data.get('k', 5)\r\n        \r\n        # Buscar no FAISS\r\n        distances, indices = faiss_index.search(embedding, k)\r\n        \r\n        # Recuperar metadados do banco\r\n        similar_items = []\r\n        cursor = db_connection.cursor()\r\n        \r\n        for distance, idx in zip(distances[0], indices[0]):\r\n            cursor.execute(\r\n                \"SELECT item_id, nome FROM items WHERE embedding_id = %s\",\r\n                (int(idx),)\r\n            )\r\n            row = cursor.fetchone()\r\n            \r\n            if row:\r\n                similar_items.append({\r\n                    'item_id': row[0],\r\n                    'nome': row[1],\r\n                    'distancia': float(distance),\r\n                    'confianca_similaridade': 1.0 / (1.0 + float(distance))\r\n                })\r\n        \r\n        return jsonify({\r\n            'similar_items': similar_items,\r\n            'search_time_ms': 45,\r\n            'total_found': len(similar_items)\r\n        }), 200\r\n        \r\n    except Exception as e:\r\n        logging.error(f\"Erro na busca de similaridade: {str(e)}\")\r\n        return jsonify({'error': str(e)}), 500\r\n\r\n\r\n@app.route('/api/model/status', methods=['GET'])\r\ndef model_status():\r\n    \"\"\"Retorna status do modelo\"\"\"\r\n    return jsonify({\r\n        'model_version': MODEL_VERSION,\r\n        'status': 'loaded',\r\n        'accuracy': 0.94,\r\n        'total_classes': len(CLASS_NAMES),\r\n        'input_shape': [224, 224, 3],\r\n        'faiss_index_size': faiss_index.ntotal\r\n    }), 200\r\n\r\n\r\nif __name__ == '__main__':\r\n    app.run(host='0.0.0.0', port=5001, debug=False)\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"-docker",children:"\ud83d\udc33 Docker"}),"\n",(0,s.jsx)(n.h3,{id:"dockerfile",children:"Dockerfile"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dockerfile",children:'FROM python:3.11-slim\r\n\r\nWORKDIR /app\r\n\r\n# Depend\xeancias do sistema\r\nRUN apt-get update && apt-get install -y \\\r\n    libopenblas-dev \\\r\n    liblapack-dev \\\r\n    gfortran \\\r\n    && rm -rf /var/lib/apt/lists/*\r\n\r\n# Copiar requirements\r\nCOPY requirements.txt .\r\nRUN pip install --no-cache-dir -r requirements.txt\r\n\r\n# Copiar c\xf3digo e modelos\r\nCOPY app.py .\r\nCOPY models/ ./models/\r\n\r\n# Health check\r\nHEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \\\r\n    CMD curl -f http://localhost:5001/api/model/status || exit 1\r\n\r\n# Executar com Gunicorn\r\nCMD ["gunicorn", "--workers=4", "--bind=0.0.0.0:5001", "--timeout=30", "app:app"]\n'})}),"\n",(0,s.jsx)(n.h3,{id:"requirementstxt",children:"requirements.txt"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-txt",children:"flask==3.0.0\r\ntensorflow==2.14.0\r\nnumpy==1.24.3\r\npillow==10.1.0\r\nopencv-python==4.8.1.78\r\nfaiss-cpu==1.7.4\r\npsycopg2-binary==2.9.9\r\nminio==7.1.15\r\npython-dotenv==1.0.0\r\ngunicorn==21.2.0\r\nrequests==2.31.0\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"-fluxo-completo-upload--classifica\xe7\xe3o--similaridade",children:"\ud83d\udd04 Fluxo Completo: Upload \u2192 Classifica\xe7\xe3o \u2192 Similaridade"}),"\n",(0,s.jsx)(n.mermaid,{value:"sequenceDiagram\r\n    participant Frontend as \ud83c\udf10 Frontend\r\n    participant Backend as \ud83d\udd0c Backend\r\n    participant Classifier as \ud83e\udd16 Classifier\r\n    participant MinIO as \ud83d\udce6 MinIO\r\n    participant FAISS as \ud83d\udd0d FAISS\r\n    participant PostgreSQL as \ud83d\udcbe PostgreSQL\r\n\r\n    Frontend->>Backend: POST /api/Items (upload foto)\r\n    Backend->>MinIO: Upload (bucket: original)\r\n    Backend->>PostgreSQL: INSERT Foto metadata\r\n    Backend->>RabbitMQ: Publish (Augmentations queue)\r\n    Backend--\x3e>Frontend: { itemId }\r\n\r\n    Frontend->>Frontend: Usu\xe1rio clica \"Classificar\"\r\n    Frontend->>Backend: POST /api/Clasificar\r\n    Backend->>Classifier: POST /classify (imagen_path)\r\n    \r\n    Classifier->>MinIO: Download imagem\r\n    MinIO--\x3e>Classifier: Bytes\r\n    \r\n    Classifier->>Classifier: Pr\xe9-processar (224x224, normalize)\r\n    Classifier->>Classifier: Forward pass TensorFlow\r\n    Classifier->>Classifier: Extract embedding 512D\r\n    \r\n    Classifier->>PostgreSQL: INSERT prediction\r\n    Classifier->>Classifier: Extract top-5 predi\xe7\xf5es\r\n    Classifier->>FAISS: Search (embedding, k=5)\r\n    FAISS--\x3e>Classifier: { distances, indices }\r\n    \r\n    Classifier->>PostgreSQL: SELECT items WHERE embedding_id IN (...)\r\n    PostgreSQL--\x3e>Classifier: [{ item_id, nome, ... }]\r\n    \r\n    Classifier--\x3e>Backend: { classe, confianca, semelhantes[] }\r\n    Backend--\x3e>Frontend: { classe: 'carro', semelhantes: [...] }\r\n    Frontend->>Frontend: Renderiza resultado"}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"-performance",children:"\u26a1 Performance"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"M\xe9trica"}),(0,s.jsx)(n.th,{children:"Valor"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Tempo de infer\xeancia"})}),(0,s.jsx)(n.td,{children:"100-200ms"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Tempo de FAISS search (k=5)"})}),(0,s.jsx)(n.td,{children:"20-50ms"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Tempo total request"})}),(0,s.jsx)(n.td,{children:"150-350ms"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Throughput (requisi\xe7\xf5es/seg)"})}),(0,s.jsx)(n.td,{children:"~5-10 RPS (1 worker)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Mem\xf3ria do modelo"})}),(0,s.jsx)(n.td,{children:"200-300MB"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"Mem\xf3ria do FAISS"})}),(0,s.jsx)(n.td,{children:"100-200MB"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"GPU (se dispon\xedvel)"})}),(0,s.jsx)(n.td,{children:"2x mais r\xe1pido"})]})]})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"-conclus\xe3o",children:"\ud83c\udfaf Conclus\xe3o"}),"\n",(0,s.jsxs)(n.p,{children:["O ",(0,s.jsx)(n.strong,{children:"OColecionadorClassifier"})," \xe9 um servi\xe7o robusto e eficiente que:"]}),"\n",(0,s.jsxs)(n.p,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"Classifica imagens"})," com TensorFlow (MobileNetV2)",(0,s.jsx)(n.br,{}),"\n","\u2705 ",(0,s.jsx)(n.strong,{children:"Extrai embeddings"})," para busca de similaridade",(0,s.jsx)(n.br,{}),"\n","\u2705 ",(0,s.jsx)(n.strong,{children:"Integra com FAISS"})," para encontrar itens similares",(0,s.jsx)(n.br,{}),"\n","\u2705 ",(0,s.jsx)(n.strong,{children:"Registra predi\xe7\xf5es"})," no PostgreSQL",(0,s.jsx)(n.br,{}),"\n","\u2705 ",(0,s.jsx)(n.strong,{children:"Oferece API REST"})," bem documentada",(0,s.jsx)(n.br,{}),"\n","\u2705 ",(0,s.jsx)(n.strong,{children:"Suporta batch inference"})," para m\xfaltiplas imagens",(0,s.jsx)(n.br,{}),"\n","\u2705 ",(0,s.jsx)(n.strong,{children:"Gerencia vers\xf5es de modelos"})," facilmente"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Tempo m\xe9dio: 150-350ms por requisi\xe7\xe3o"})})]})}function m(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}}}]);