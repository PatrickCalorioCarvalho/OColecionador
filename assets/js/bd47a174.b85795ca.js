"use strict";(globalThis.webpackChunkdocumentation=globalThis.webpackChunkdocumentation||[]).push([[6557],{4926:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>s,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"ocolecionadorbackend","title":"OColecionadorBackEnd","description":"\ud83d\udccb Vis\xe3o Geral","source":"@site/docs/ocolecionadorbackend.md","sourceDirName":".","slug":"/ocolecionadorbackend","permalink":"/OColecionador/docs/ocolecionadorbackend","draft":false,"unlisted":false,"editUrl":"https://github.com/PatrickCalorioCarvalho/OColecionador/edit/main/Documentation/docs/docs/ocolecionadorbackend.md","tags":[],"version":"current","frontMatter":{"id":"ocolecionadorbackend","title":"OColecionadorBackEnd","sidebar_label":"Introdu\xe7\xe3o"},"sidebar":"docs","previous":{"title":"OColecionador","permalink":"/OColecionador/docs/intro"},"next":{"title":"Avan\xe7ado","permalink":"/OColecionador/docs/ocolecionadorbackend-advanced"}}');var a=r(4848),o=r(8453);const s={id:"ocolecionadorbackend",title:"OColecionadorBackEnd",sidebar_label:"Introdu\xe7\xe3o"},c="OColecionadorBackEnd",d={},l=[{value:"\ud83d\udccb Vis\xe3o Geral",id:"-vis\xe3o-geral",level:2},{value:"Responsabilidades Principais",id:"responsabilidades-principais",level:3},{value:"\ud83c\udfd7\ufe0f Arquitetura",id:"\ufe0f-arquitetura",level:2},{value:"Estrutura de Pastas",id:"estrutura-de-pastas",level:3},{value:"\ud83d\udd0c Servi\xe7os Principais",id:"-servi\xe7os-principais",level:2},{value:"1. <strong>MinioService</strong>",id:"1-minioservice",level:3},{value:"2. <strong>RabbitService</strong>",id:"2-rabbitservice",level:3},{value:"3. <strong>DockerService</strong>",id:"3-dockerservice",level:3},{value:"\ud83d\uddc4\ufe0f Modelo de Dados",id:"\ufe0f-modelo-de-dados",level:2},{value:"Entidades Principais",id:"entidades-principais",level:3},{value:"\ud83d\udd0c Endpoints REST",id:"-endpoints-rest",level:2},{value:"Autentica\xe7\xe3o",id:"autentica\xe7\xe3o",level:3},{value:"Categorias",id:"categorias",level:3},{value:"Itens",id:"itens",level:3},{value:"Fotos",id:"fotos",level:3},{value:"Classifica\xe7\xe3o (com IA)",id:"classifica\xe7\xe3o-com-ia",level:3},{value:"Docker",id:"docker",level:3},{value:"\ud83d\udd10 Autentica\xe7\xe3o e Autoriza\xe7\xe3o",id:"-autentica\xe7\xe3o-e-autoriza\xe7\xe3o",level:2},{value:"Fluxo OAuth2",id:"fluxo-oauth2",level:3},{value:"Middleware de Autentica\xe7\xe3o",id:"middleware-de-autentica\xe7\xe3o",level:3},{value:"\ud83d\udd04 Fluxos Complexos com M\xfaltiplos Servi\xe7os",id:"-fluxos-complexos-com-m\xfaltiplos-servi\xe7os",level:2},{value:"Fluxo 1: Upload de Item com Foto",id:"fluxo-1-upload-de-item-com-foto",level:3},{value:"Fluxo 2: Classifica\xe7\xe3o de Imagem (com Infer\xeancia de IA)",id:"fluxo-2-classifica\xe7\xe3o-de-imagem-com-infer\xeancia-de-ia",level:3},{value:"Fluxo 3: Treinamento do Modelo",id:"fluxo-3-treinamento-do-modelo",level:3},{value:"Fluxo 4: Dashboard Docker Management",id:"fluxo-4-dashboard-docker-management",level:3},{value:"\ud83d\udd17 Integra\xe7\xe3o com Servi\xe7os Externos",id:"-integra\xe7\xe3o-com-servi\xe7os-externos",level:2},{value:"MinIO (Armazenamento)",id:"minio-armazenamento",level:3},{value:"RabbitMQ (Fila de Mensagens)",id:"rabbitmq-fila-de-mensagens",level:3},{value:"SQL Server (Banco de Dados)",id:"sql-server-banco-de-dados",level:3},{value:"Docker API",id:"docker-api",level:3},{value:"\ud83d\udcca Diagrama de Componentes",id:"-diagrama-de-componentes",level:2},{value:"\ud83d\ude80 Deployment",id:"-deployment",level:2},{value:"Docker",id:"docker-1",level:3},{value:"Docker Compose",id:"docker-compose",level:3},{value:"\ud83e\uddea Desenvolvimento Local",id:"-desenvolvimento-local",level:2},{value:"\ud83d\udce6 Depend\xeancias",id:"-depend\xeancias",level:2},{value:"\ud83d\udcdd Conclus\xe3o",id:"-conclus\xe3o",level:2}];function t(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"ocolecionadorbackend",children:"OColecionadorBackEnd"})}),"\n",(0,a.jsx)(n.h2,{id:"-vis\xe3o-geral",children:"\ud83d\udccb Vis\xe3o Geral"}),"\n",(0,a.jsxs)(n.p,{children:["O ",(0,a.jsx)(n.strong,{children:"OColecionadorBackEnd"})," \xe9 a API REST central do projeto OColecionador, desenvolvida em ",(0,a.jsx)(n.strong,{children:"C# com .NET 8"})," e ",(0,a.jsx)(n.strong,{children:"ASP.NET Core"}),". Ele funciona como orquestrador entre o aplicativo mobile, servi\xe7os de IA (classifica\xe7\xe3o, treinamento, augmentations) e infraestrutura de armazenamento."]}),"\n",(0,a.jsx)(n.h3,{id:"responsabilidades-principais",children:"Responsabilidades Principais"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\ud83d\udd10 ",(0,a.jsx)(n.strong,{children:"Autentica\xe7\xe3o e Autoriza\xe7\xe3o"})," \u2013 OAuth2 com Google e GitHub"]}),"\n",(0,a.jsxs)(n.li,{children:["\ud83d\udcf8 ",(0,a.jsx)(n.strong,{children:"Gerenciamento de Imagens"})," \u2013 Upload, armazenamento no MinIO e metadados no SQL Server"]}),"\n",(0,a.jsxs)(n.li,{children:["\ud83c\udff7\ufe0f ",(0,a.jsx)(n.strong,{children:"Gerenciamento de Categorias"})," \u2013 CRUD de categorias de colecion\xe1veis"]}),"\n",(0,a.jsxs)(n.li,{children:["\ud83d\udce6 ",(0,a.jsx)(n.strong,{children:"Gerenciamento de Itens"})," \u2013 CRUD de itens com relacionamento a fotos"]}),"\n",(0,a.jsxs)(n.li,{children:["\ud83e\udd16 ",(0,a.jsx)(n.strong,{children:"Integra\xe7\xe3o com IA"})," \u2013 Comunica\xe7\xe3o com servi\xe7os de classifica\xe7\xe3o, treinamento e augmentations"]}),"\n",(0,a.jsxs)(n.li,{children:["\ud83d\udc33 ",(0,a.jsx)(n.strong,{children:"Controle de Containers Docker"})," \u2013 Start/stop/restart de servi\xe7os via API"]}),"\n",(0,a.jsxs)(n.li,{children:["\ud83d\udce8 ",(0,a.jsx)(n.strong,{children:"Fila de Processamento"})," \u2013 Integra\xe7\xe3o com RabbitMQ para tarefas ass\xedncronas"]}),"\n"]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"\ufe0f-arquitetura",children:"\ud83c\udfd7\ufe0f Arquitetura"}),"\n",(0,a.jsx)(n.h3,{id:"estrutura-de-pastas",children:"Estrutura de Pastas"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"OColecionadorBackEnd/\r\n\u251c\u2500\u2500 Controllers/                    # Endpoints REST\r\n\u2502   \u251c\u2500\u2500 AuthController.cs          # Autentica\xe7\xe3o OAuth2\r\n\u2502   \u251c\u2500\u2500 CategoriasController.cs    # CRUD de categorias\r\n\u2502   \u251c\u2500\u2500 ItemsController.cs         # CRUD de itens com fotos\r\n\u2502   \u251c\u2500\u2500 FotosController.cs         # Gerenciamento de fotos\r\n\u2502   \u251c\u2500\u2500 ClasificarController.cs    # Classifica\xe7\xe3o de imagens\r\n\u2502   \u2514\u2500\u2500 DockerController.cs        # Controle de containers\r\n\u251c\u2500\u2500 Data/\r\n\u2502   \u2514\u2500\u2500 OColecionadorBackEndContext.cs  # DbContext do Entity Framework\r\n\u251c\u2500\u2500 Model/\r\n\u2502   \u251c\u2500\u2500 Categoria.cs              # Entidade de categoria\r\n\u2502   \u251c\u2500\u2500 Item.cs                   # Entidade de item\r\n\u2502   \u251c\u2500\u2500 Foto.cs                   # Entidade de foto\r\n\u2502   \u251c\u2500\u2500 FotoMessage.cs            # DTO para fila\r\n\u2502   \u2514\u2500\u2500 ...\r\n\u251c\u2500\u2500 Service/\r\n\u2502   \u251c\u2500\u2500 MinioService.cs           # Integra\xe7\xe3o com MinIO (S3)\r\n\u2502   \u251c\u2500\u2500 RabbitService.cs          # Integra\xe7\xe3o com RabbitMQ\r\n\u2502   \u251c\u2500\u2500 DockerService.cs          # Integra\xe7\xe3o com Docker API\r\n\u2502   \u2514\u2500\u2500 ...\r\n\u251c\u2500\u2500 Middlewares/\r\n\u2502   \u2514\u2500\u2500 OAuthMiddleware.cs        # Middleware de autentica\xe7\xe3o\r\n\u251c\u2500\u2500 Migrations/                    # Migra\xe7\xf5es do Entity Framework\r\n\u2514\u2500\u2500 Program.cs                     # Configura\xe7\xe3o da aplica\xe7\xe3o\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"-servi\xe7os-principais",children:"\ud83d\udd0c Servi\xe7os Principais"}),"\n",(0,a.jsxs)(n.h3,{id:"1-minioservice",children:["1. ",(0,a.jsx)(n.strong,{children:"MinioService"})]}),"\n",(0,a.jsx)(n.p,{children:"Gerencia upload, download e presigned URLs de imagens no MinIO (storage S3-compat\xedvel)."}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Depend\xeancias:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"MinIO Client"}),"\n",(0,a.jsx)(n.li,{children:"IConfiguration (appsettings.json)"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"M\xe9todos principais:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-csharp",children:"- GetPresignedUrlAsync(string path) // Retorna URL tempor\xe1ria\r\n- UploadFileAsync(string bucket, string objectName, Stream data)\r\n- DeleteFileAsync(string bucket, string objectName)\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsxs)(n.h3,{id:"2-rabbitservice",children:["2. ",(0,a.jsx)(n.strong,{children:"RabbitService"})]}),"\n",(0,a.jsx)(n.p,{children:"Enfileira mensagens para processamento ass\xedncrono em outros servi\xe7os (Augmentations, Training)."}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Depend\xeancias:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"RabbitMQ.Client"}),"\n",(0,a.jsx)(n.li,{children:"IConfiguration"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"M\xe9todos principais:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-csharp",children:"- PublishMessageAsync(string queue, object message) // Publica na fila\r\n- ConsumeMessagesAsync(string queue, Action<string> callback)\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsxs)(n.h3,{id:"3-dockerservice",children:["3. ",(0,a.jsx)(n.strong,{children:"DockerService"})]}),"\n",(0,a.jsx)(n.p,{children:"Controla containers Docker via Docker API (lista, inicia, para, reinicia)."}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Depend\xeancias:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Docker.DotNet"}),"\n",(0,a.jsx)(n.li,{children:"Environment variables (DOCKER_URI)"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"M\xe9todos principais:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-csharp",children:"- ListContainersAsync() // Lista todos os containers\r\n- StartContainerAsync(string containerId)\r\n- StopContainerAsync(string containerId)\r\n- RestartContainerAsync(string containerId)\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"\ufe0f-modelo-de-dados",children:"\ud83d\uddc4\ufe0f Modelo de Dados"}),"\n",(0,a.jsx)(n.h3,{id:"entidades-principais",children:"Entidades Principais"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-csharp",children:"// Categoria\r\npublic class Categoria\r\n{\r\n    public int Id { get; set; }\r\n    public string Descricao { get; set; }\r\n    public ICollection<Item> Itens { get; set; }\r\n}\r\n\r\n// Item\r\npublic class Item\r\n{\r\n    public int Id { get; set; }\r\n    public string Nome { get; set; }\r\n    public int CategoriaId { get; set; }\r\n    public Categoria Categoria { get; set; }\r\n    public ICollection<Foto> Fotos { get; set; }\r\n}\r\n\r\n// Foto\r\npublic class Foto\r\n{\r\n    public int Id { get; set; }\r\n    public int ItemId { get; set; }\r\n    public string Caminho { get; set; } // Path no MinIO\r\n    public Item Item { get; set; }\r\n}\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"-endpoints-rest",children:"\ud83d\udd0c Endpoints REST"}),"\n",(0,a.jsx)(n.h3,{id:"autentica\xe7\xe3o",children:"Autentica\xe7\xe3o"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"POST /api/auth/login"})," \u2013 Inicia fluxo OAuth2"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"POST /api/auth/callback"})," \u2013 Callback do provedor OAuth"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"categorias",children:"Categorias"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"GET /api/Categorias"})," \u2013 Lista todas as categorias"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"POST /api/Categorias"})," \u2013 Cria nova categoria"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"PUT /api/Categorias/{id}"})," \u2013 Atualiza categoria"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"DELETE /api/Categorias/{id}"})," \u2013 Deleta categoria"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"itens",children:"Itens"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"GET /api/Items"})," \u2013 Lista itens com fotos e URLs do MinIO"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"POST /api/Items"})," \u2013 Cria item com upload de fotos"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"PUT /api/Items/{id}"})," \u2013 Atualiza item"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"DELETE /api/Items/{id}"})," \u2013 Deleta item"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"fotos",children:"Fotos"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"POST /api/Fotos"})," \u2013 Upload de foto para item existente"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"DELETE /api/Fotos/{id}"})," \u2013 Deleta foto"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"classifica\xe7\xe3o-com-ia",children:"Classifica\xe7\xe3o (com IA)"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"POST /api/Clasificar"})," \u2013 Classifica imagem via OColecionadorClassifier"]}),"\n",(0,a.jsxs)(n.li,{children:["Retorna: ",(0,a.jsx)(n.code,{children:"{ classe, confianca, itemsSemelhantes }"})]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"docker",children:"Docker"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"GET /api/Docker"})," \u2013 Lista containers"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"POST /api/Docker/start/{id}"})," \u2013 Inicia container"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"POST /api/Docker/stop/{id}"})," \u2013 Para container"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"POST /api/Docker/restart/{id}"})," \u2013 Reinicia container"]}),"\n"]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"-autentica\xe7\xe3o-e-autoriza\xe7\xe3o",children:"\ud83d\udd10 Autentica\xe7\xe3o e Autoriza\xe7\xe3o"}),"\n",(0,a.jsx)(n.h3,{id:"fluxo-oauth2",children:"Fluxo OAuth2"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"1. Frontend/Mobile abre login\r\n   \u2193\r\n2. Redireciona para Google/GitHub\r\n   \u2193\r\n3. Usu\xe1rio autoriza\r\n   \u2193\r\n4. Google/GitHub retorna code\r\n   \u2193\r\n5. Backend troca code por token\r\n   \u2193\r\n6. Token armazenado como cookie/localStorage\r\n   \u2193\r\n7. Requisi\xe7\xf5es subsequentes incluem token no header Authorization: Bearer {token}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"middleware-de-autentica\xe7\xe3o",children:"Middleware de Autentica\xe7\xe3o"}),"\n",(0,a.jsxs)(n.p,{children:["O ",(0,a.jsx)(n.a,{href:"c:%5CUsers%5CPatrick%5CDesktop%5COColecionador%5COColecionadorBackEnd%5CMiddlewares%5COAuthMiddleware.cs",children:(0,a.jsx)(n.code,{children:"OAuthMiddleware.cs"})})," valida tokens nas requisi\xe7\xf5es."]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"-fluxos-complexos-com-m\xfaltiplos-servi\xe7os",children:"\ud83d\udd04 Fluxos Complexos com M\xfaltiplos Servi\xe7os"}),"\n",(0,a.jsx)(n.h3,{id:"fluxo-1-upload-de-item-com-foto",children:"Fluxo 1: Upload de Item com Foto"}),"\n",(0,a.jsx)(n.mermaid,{value:"sequenceDiagram\r\n    participant Mobile as App Mobile\r\n    participant Backend as Backend (.NET)\r\n    participant MinIO as MinIO\r\n    participant DB as SQL Server\r\n    participant Rabbit as RabbitMQ\r\n    participant Aug as Augmentations\r\n\r\n    Mobile->>Backend: POST /api/Items (FormData com foto)\r\n    Backend->>MinIO: UploadFile (bucket: original)\r\n    MinIO--\x3e>Backend: { url, path }\r\n    Backend->>DB: SaveItem + Foto metadata\r\n    Backend->>Rabbit: PublishMessage (ImageAugmentations queue)\r\n    Rabbit--\x3e>Aug: ConsumeMessage\r\n    Aug->>MinIO: DownloadFile (original)\r\n    Aug->>Aug: Apply augmentations\r\n    Aug->>MinIO: UploadFile (bucket: processed)\r\n    Aug->>DB: SaveMetadata\r\n    Backend--\x3e>Mobile: { itemId, success }"}),"\n",(0,a.jsx)(n.h3,{id:"fluxo-2-classifica\xe7\xe3o-de-imagem-com-infer\xeancia-de-ia",children:"Fluxo 2: Classifica\xe7\xe3o de Imagem (com Infer\xeancia de IA)"}),"\n",(0,a.jsx)(n.mermaid,{value:"sequenceDiagram\r\n    participant Mobile as App Mobile\r\n    participant Backend as Backend (.NET)\r\n    participant MinIO as MinIO\r\n    participant DB as SQL Server\r\n    participant Classifier as Classifier API\r\n\r\n    Mobile->>Backend: POST /api/Clasificar (FormData com foto)\r\n    Backend->>MinIO: UploadFile (temp bucket)\r\n    MinIO--\x3e>Backend: { path }\r\n    Backend->>DB: SaveTemporaryFoto\r\n    Backend->>Classifier: POST /classify (image_path)\r\n    Classifier->>MinIO: DownloadFile\r\n    Classifier->>Classifier: TensorFlow inference\r\n    Classifier--\x3e>Backend: { classe, confianca, embeddings }\r\n    Backend->>DB: SaveClassification\r\n    Backend->>DB: FindSimilarItems (via FAISS embeddings)\r\n    Backend--\x3e>Mobile: { classe, confianca, itemsSemelhantes[] }"}),"\n",(0,a.jsx)(n.h3,{id:"fluxo-3-treinamento-do-modelo",children:"Fluxo 3: Treinamento do Modelo"}),"\n",(0,a.jsx)(n.mermaid,{value:"sequenceDiagram\r\n    participant User as Dashboard Admin\r\n    participant Backend as Backend (.NET)\r\n    participant Docker as Docker API\r\n    participant Rabbit as RabbitMQ\r\n    participant Training as Training Service\r\n    participant MinIO as MinIO\r\n    participant DB as PostgreSQL\r\n\r\n    User->>Backend: POST /api/Docker/start/ocolecionadortraining\r\n    Backend->>Docker: StartContainer (training)\r\n    Docker--\x3e>Backend: { status: running }\r\n    Backend--\x3e>User: Container started\r\n    Training->>Rabbit: ConsumeMessage (ImageAugmentations queue)\r\n    Training->>MinIO: DownloadFile (processed bucket)\r\n    Training->>Training: Train TensorFlow model\r\n    Training->>MinIO: UploadFile (models bucket)\r\n    Training->>DB: SaveModelMetrics\r\n    Training->>Backend: UpdateModelVersion API"}),"\n",(0,a.jsx)(n.h3,{id:"fluxo-4-dashboard-docker-management",children:"Fluxo 4: Dashboard Docker Management"}),"\n",(0,a.jsx)(n.mermaid,{value:"sequenceDiagram\r\n    participant Frontend as Frontend React\r\n    participant Backend as Backend (.NET)\r\n    participant Docker as Docker API\r\n\r\n    Frontend->>Backend: GET /api/Docker\r\n    Backend->>Docker: ListContainersAsync()\r\n    Docker--\x3e>Backend: { containers[] }\r\n    Backend--\x3e>Frontend: { id, name, state, status, image }\r\n    Frontend->>Frontend: Render container cards\r\n    \r\n    Frontend->>Backend: POST /api/Docker/restart/{id}\r\n    Backend->>Docker: RestartContainerAsync(id)\r\n    Docker--\x3e>Backend: { status: ok }\r\n    Backend--\x3e>Frontend: { success: true }"}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"-integra\xe7\xe3o-com-servi\xe7os-externos",children:"\ud83d\udd17 Integra\xe7\xe3o com Servi\xe7os Externos"}),"\n",(0,a.jsx)(n.h3,{id:"minio-armazenamento",children:"MinIO (Armazenamento)"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\r\n  "Minio": {\r\n    "Endpoint": "minio:9000",\r\n    "AccessKey": "OColecionadorUser",\r\n    "SecretKey": "OColecionador@2025",\r\n    "pathExtern": "https://louse-model-lioness.ngrok-free.app/"\r\n  }\r\n}\n'})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Buckets:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"ocolecionadorbucket-original"})," \u2013 Imagens originais"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"ocolecionadorbucket-processed"})," \u2013 Imagens com augmentations"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"ocolecionadorbucket-models"})," \u2013 Modelos treinados"]}),"\n"]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h3,{id:"rabbitmq-fila-de-mensagens",children:"RabbitMQ (Fila de Mensagens)"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\r\n  "Rabbit": {\r\n    "HostName": "rabbitmq",\r\n    "UserName": "OColecionadorUser",\r\n    "Password": "OColecionador@2025"\r\n  }\r\n}\n'})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Filas:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"ImageAugmentations"})," \u2013 Trigger para augmentations service"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"ModelTraining"})," \u2013 Trigger para training service"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Formato de mensagem:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\r\n  "Caminho": "bucket/imagem.jpg",\r\n  "Categoria": "animais",\r\n  "ItemId": 12345\r\n}\n'})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h3,{id:"sql-server-banco-de-dados",children:"SQL Server (Banco de Dados)"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Tabelas principais:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"Categorias"})," \u2013 Categorias de colecion\xe1veis"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"Items"})," \u2013 Itens da cole\xe7\xe3o"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"Fotos"})," \u2013 Fotos dos itens"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Connection String:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"Server=sqlserver;Database=OColecionadorDataBase;User Id=OColecionadorUser;Password=OColecionador@2025;\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h3,{id:"docker-api",children:"Docker API"}),"\n",(0,a.jsx)(n.p,{children:"Conecta via socket Unix (Linux/Mac) ou named pipe (Windows):"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-csharp",children:'var dockerUri = Environment.GetEnvironmentVariable("DOCKER_URI") ?? "unix:///var/run/docker.sock";\n'})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"-diagrama-de-componentes",children:"\ud83d\udcca Diagrama de Componentes"}),"\n",(0,a.jsx)(n.mermaid,{value:'graph TB\r\n    subgraph Client["Frontend & Mobile"]\r\n        WEB["\ud83c\udf10 Frontend React"]\r\n        MOBILE["\ud83d\udcf1 App Mobile"]\r\n    end\r\n    \r\n    subgraph Backend["Backend .NET 8"]\r\n        API["\ud83d\udd0c API Controllers"]\r\n        AUTH["\ud83d\udd10 OAuth Middleware"]\r\n        DB_CONTEXT["\ud83d\udcbe EF Core DbContext"]\r\n    end\r\n    \r\n    subgraph Services["Business Services"]\r\n        MINIO_SVC["\ud83d\udce6 MinioService"]\r\n        RABBIT_SVC["\ud83d\udce8 RabbitService"]\r\n        DOCKER_SVC["\ud83d\udc33 DockerService"]\r\n    end\r\n    \r\n    subgraph External["External Services"]\r\n        MINIO["MinIO Storage"]\r\n        RABBIT["RabbitMQ"]\r\n        SQLSERVER["SQL Server"]\r\n        DOCKER["Docker Daemon"]\r\n    end\r\n    \r\n    subgraph ML["AI Services"]\r\n        CLASSIFIER["\ud83e\udd16 Classifier API"]\r\n        TRAINING["\ud83e\udde0 Training Service"]\r\n        AUGMENTATIONS["\ud83c\udfa8 Augmentations"]\r\n    end\r\n    \r\n    WEB --\x3e API\r\n    MOBILE --\x3e API\r\n    API --\x3e AUTH\r\n    API --\x3e DB_CONTEXT\r\n    API --\x3e MINIO_SVC\r\n    API --\x3e RABBIT_SVC\r\n    API --\x3e DOCKER_SVC\r\n    \r\n    MINIO_SVC --\x3e MINIO\r\n    RABBIT_SVC --\x3e RABBIT\r\n    DB_CONTEXT --\x3e SQLSERVER\r\n    DOCKER_SVC --\x3e DOCKER\r\n    \r\n    RABBIT --\x3e AUGMENTATIONS\r\n    RABBIT --\x3e TRAINING\r\n    AUGMENTATIONS --\x3e MINIO\r\n    TRAINING --\x3e CLASSIFIER\r\n    API --\x3e CLASSIFIER'}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"-deployment",children:"\ud83d\ude80 Deployment"}),"\n",(0,a.jsx)(n.h3,{id:"docker-1",children:"Docker"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'docker build -t ocolecionador-backend:latest .\r\ndocker run -p 5000:8080 \\\r\n  -e DOCKER_URI="unix:///var/run/docker.sock" \\\r\n  ocolecionador-backend:latest\n'})}),"\n",(0,a.jsx)(n.h3,{id:"docker-compose",children:"Docker Compose"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"docker compose up ocolecionadorbackend\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"-desenvolvimento-local",children:"\ud83e\uddea Desenvolvimento Local"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Restaurar depend\xeancias\r\ndotnet restore\r\n\r\n# Executar migra\xe7\xf5es\r\ndotnet ef database update\r\n\r\n# Executar em desenvolvimento\r\ndotnet run --launch-profile https\r\n\r\n# Build para release\r\ndotnet publish -c Release -o ./publish\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"-depend\xeancias",children:"\ud83d\udce6 Depend\xeancias"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-xml",children:"- Docker.DotNet (3.125.15)\r\n- Microsoft.EntityFrameworkCore.SqlServer (8.0.11)\r\n- Minio (6.0.5)\r\n- RabbitMQ.Client (7.1.2)\r\n- Swashbuckle.AspNetCore (6.6.2)\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"-conclus\xe3o",children:"\ud83d\udcdd Conclus\xe3o"}),"\n",(0,a.jsxs)(n.p,{children:["O ",(0,a.jsx)(n.strong,{children:"OColecionadorBackEnd"})," \xe9 o cora\xe7\xe3o da arquitetura, orquestrando comunica\xe7\xe3o entre frontend, servi\xe7os de IA e infraestrutura, garantindo um fluxo robusto de captura, armazenamento, processamento e classifica\xe7\xe3o de imagens."]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(t,{...e})}):t(e)}}}]);