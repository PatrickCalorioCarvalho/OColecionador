"use strict";(globalThis.webpackChunkdocumentation=globalThis.webpackChunkdocumentation||[]).push([[3427],{7929:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>c,contentTitle:()=>t,default:()=>m,frontMatter:()=>s,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"ocolecionadormobile-advanced","title":"OColecionadorMobile - Fluxos Avan\xe7ados","description":"Documenta\xe7\xe3o detalhada dos fluxos complexos e padr\xf5es avan\xe7ados do app mobile.","source":"@site/docs/ocolecionadormobile-advanced.md","sourceDirName":".","slug":"/ocolecionadormobile-advanced","permalink":"/OColecionador/docs/ocolecionadormobile-advanced","draft":false,"unlisted":false,"editUrl":"https://github.com/PatrickCalorioCarvalho/OColecionador/edit/main/Documentation/docs/docs/ocolecionadormobile-advanced.md","tags":[],"version":"current","frontMatter":{"id":"ocolecionadormobile-advanced","title":"OColecionadorMobile - Fluxos Avan\xe7ados","sidebar_label":"Avan\xe7ado"},"sidebar":"docs","previous":{"title":"Introdu\xe7\xe3o","permalink":"/OColecionador/docs/ocolecionadormobile"},"next":{"title":"Introdu\xe7\xe3o","permalink":"/OColecionador/docs/arquitetura-cicd-infraestrutura"}}');var o=n(4848),i=n(8453);const s={id:"ocolecionadormobile-advanced",title:"OColecionadorMobile - Fluxos Avan\xe7ados",sidebar_label:"Avan\xe7ado"},t="OColecionadorMobile - Fluxos Avan\xe7ados",c={},l=[{value:"\ud83d\udd10 Fluxo 1: Autentica\xe7\xe3o OAuth2 com Deep Linking",id:"-fluxo-1-autentica\xe7\xe3o-oauth2-com-deep-linking",level:2},{value:"\ud83d\udcf8 Fluxo 2: Captura e Upload Multi-Foto",id:"-fluxo-2-captura-e-upload-multi-foto",level:2},{value:"\ud83e\udd16 Fluxo 3: Classifica\xe7\xe3o com IA",id:"-fluxo-3-classifica\xe7\xe3o-com-ia",level:2},{value:"\ud83d\udd04 Fluxo 4: Pull-to-Refresh na Galeria",id:"-fluxo-4-pull-to-refresh-na-galeria",level:2},{value:"\ud83c\udfa8 Interceptor de Requisi\xe7\xf5es",id:"-interceptor-de-requisi\xe7\xf5es",level:2},{value:"\ud83d\udcf1 Lazy Loading de Imagens",id:"-lazy-loading-de-imagens",level:2},{value:"\ud83d\udd10 Seguran\xe7a com Deep Linking",id:"-seguran\xe7a-com-deep-linking",level:2},{value:"\ud83d\udcca Diagrama de Navega\xe7\xe3o Mobile",id:"-diagrama-de-navega\xe7\xe3o-mobile",level:2},{value:"\ud83d\udcc8 Performance Checklist",id:"-performance-checklist",level:2},{value:"\ud83c\udfaf Conclus\xe3o",id:"-conclus\xe3o",level:2}];function d(e){const r={br:"br",code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.header,{children:(0,o.jsx)(r.h1,{id:"ocolecionadormobile---fluxos-avan\xe7ados",children:"OColecionadorMobile - Fluxos Avan\xe7ados"})}),"\n",(0,o.jsx)(r.p,{children:"Documenta\xe7\xe3o detalhada dos fluxos complexos e padr\xf5es avan\xe7ados do app mobile."}),"\n",(0,o.jsx)(r.hr,{}),"\n",(0,o.jsx)(r.h2,{id:"-fluxo-1-autentica\xe7\xe3o-oauth2-com-deep-linking",children:"\ud83d\udd10 Fluxo 1: Autentica\xe7\xe3o OAuth2 com Deep Linking"}),"\n",(0,o.jsx)(r.mermaid,{value:"sequenceDiagram\r\n    autonumber\r\n    participant User as \ud83d\udc64 Usu\xe1rio\r\n    participant App as \ud83d\udcf1 App Mobile\r\n    participant Router as \ud83d\udee3\ufe0f Expo Router\r\n    participant SecureStore as \ud83d\udd10 Secure Store\r\n    participant WebBrowser as \ud83c\udf10 Web Browser\r\n    participant Backend as \ud83d\udd0c Backend API\r\n    participant OAuth as \ud83d\udd11 Google/GitHub\r\n\r\n    User->>App: Abre app\r\n    App->>Router: RootLayout verifica token\r\n    Router->>SecureStore: getItemAsync('token')\r\n    SecureStore--\x3e>Router: null (primeiro acesso)\r\n    Router->>App: Renderiza Login Screen\r\n    \r\n    App--\x3e>User: Exibe bot\xf5es de login\r\n    User->>App: Clica \"Entrar com Google\"\r\n    App->>WebBrowser: openAuthSessionAsync(backend/login, deepLink)\r\n    \r\n    WebBrowser->>User: Abre browser nativo\r\n    User->>Browser: Credenciais\r\n    Browser->>OAuth: Redireciona\r\n    OAuth->>Browser: Retorna c\xf3digo\r\n    Browser->>Backend: GET /auth/callback?code=...\r\n    \r\n    Backend->>Backend: Valida e gera JWT\r\n    Backend->>Browser: Redireciona com token\r\n    Browser->>App: Deep link: ocolecionadormobile://auth?token=...\r\n    \r\n    App->>SecureStore: setItemAsync('token', token)\r\n    SecureStore--\x3e>App: Token salvo criptografado\r\n    \r\n    App->>Router: Redireciona para /home\r\n    App--\x3e>User: Home screen carregada \u2713"}),"\n",(0,o.jsx)(r.hr,{}),"\n",(0,o.jsx)(r.h2,{id:"-fluxo-2-captura-e-upload-multi-foto",children:"\ud83d\udcf8 Fluxo 2: Captura e Upload Multi-Foto"}),"\n",(0,o.jsx)(r.mermaid,{value:'sequenceDiagram\r\n    autonumber\r\n    participant User as \ud83d\udc64 Usu\xe1rio\r\n    participant UI as \ud83c\udfa8 NewItem Screen\r\n    participant ImagePicker as \ud83d\udcf7 Image Picker\r\n    participant API as \ud83d\udd0c API\r\n    participant Backend as \ud83d\udd0c Backend\r\n    participant MinIO as \ud83d\udce6 MinIO\r\n    participant DB as \ud83d\udcbe SQL Server\r\n\r\n    User->>UI: Acessa "Novo Item"\r\n    UI->>API: GET /api/Categorias\r\n    Backend->>DB: SELECT * FROM Categorias\r\n    DB--\x3e>Backend: [{ id, descricao }]\r\n    API--\x3e>UI: Categorias carregadas\r\n    \r\n    User->>UI: Preenche nome\r\n    User->>UI: Seleciona categoria\r\n    User->>UI: Clica "Selecionar Foto"\r\n    \r\n    UI->>ImagePicker: launchCameraAsync()\r\n    ImagePicker->>User: C\xe2mera abre\r\n    User->>Camera: Captura foto\r\n    ImagePicker->>UI: { uri, width, height }\r\n    UI->>UI: Adiciona \xe0 lista\r\n    \r\n    User->>UI: Adiciona mais 2 fotos\r\n    UI->>UI: photos = [uri1, uri2, uri3]\r\n    \r\n    User->>UI: Clica "Salvar Item"\r\n    UI->>UI: Valida\xe7\xe3o \u2713\r\n    UI->>UI: Monta FormData\r\n    \r\n    UI->>API: POST /api/Items (FormData)\r\n    Backend->>MinIO: Upload 3 fotos\r\n    MinIO--\x3e>Backend: URLs\r\n    Backend->>DB: INSERT INTO Items + Fotos\r\n    DB--\x3e>Backend: itemId: 456\r\n    Backend->>Backend: Publica RabbitMQ\r\n    API--\x3e>UI: Success\r\n    \r\n    UI->>UI: Alert("Sucesso!")\r\n    UI->>UI: Limpa form\r\n    UI--\x3e>User: Redirecionado para Home'}),"\n",(0,o.jsx)(r.hr,{}),"\n",(0,o.jsx)(r.h2,{id:"-fluxo-3-classifica\xe7\xe3o-com-ia",children:"\ud83e\udd16 Fluxo 3: Classifica\xe7\xe3o com IA"}),"\n",(0,o.jsx)(r.mermaid,{value:'sequenceDiagram\r\n    autonumber\r\n    participant User as \ud83d\udc64 Usu\xe1rio\r\n    participant UI as \ud83e\udd16 Classify Screen\r\n    participant ImagePicker as \ud83d\udcf7 Image Picker\r\n    participant API as \ud83d\udd0c API\r\n    participant Backend as \ud83d\udd0c Backend\r\n    participant Classifier as \ud83e\udde0 Classifier\r\n    participant FAISS as \ud83d\udd0d FAISS\r\n\r\n    User->>UI: Acessa "Classificar"\r\n    User->>UI: Clica "Selecionar Imagem"\r\n    \r\n    UI->>ImagePicker: launchCameraAsync()\r\n    User->>Camera: Captura\r\n    ImagePicker->>UI: { uri }\r\n    UI->>UI: Renderiza preview\r\n    \r\n    User->>UI: Clica "Analisar Foto"\r\n    UI->>UI: setLoading(true)\r\n    \r\n    UI->>API: POST /api/Clasificar (FormData)\r\n    Backend->>Backend: Valida\r\n    Backend->>Classifier: Envia para classify\r\n    \r\n    Classifier->>Classifier: Pr\xe9-processamento\r\n    Classifier->>Classifier: TensorFlow inference\r\n    Classifier->>Classifier: Extrai embeddings\r\n    Classifier->>FAISS: search(embedding, k=5)\r\n    FAISS--\x3e>Classifier: indices + distances\r\n    \r\n    Classifier->>Classifier: Mapeia para items\r\n    Classifier--\x3e>Backend: { classe, confianca, items }\r\n    Backend--\x3e>API: JSON\r\n    \r\n    API->>UI: response.data\r\n    UI->>UI: setResultado(data)\r\n    UI->>UI: setLoading(false)\r\n    \r\n    UI->>UI: Renderiza resultado\r\n    UI--\x3e>User: Resultado exibido \u2713'}),"\n",(0,o.jsx)(r.hr,{}),"\n",(0,o.jsx)(r.h2,{id:"-fluxo-4-pull-to-refresh-na-galeria",children:"\ud83d\udd04 Fluxo 4: Pull-to-Refresh na Galeria"}),"\n",(0,o.jsx)(r.mermaid,{value:"sequenceDiagram\r\n    autonumber\r\n    participant User as \ud83d\udc64 Usu\xe1rio\r\n    participant HomeUI as \ud83d\udcf1 Home Screen\r\n    participant RefreshControl as \ud83d\udd04 RefreshControl\r\n    participant API as \ud83d\udd0c API\r\n    participant Backend as \ud83d\udd0c Backend\r\n    participant DB as \ud83d\udcbe SQL Server\r\n    participant MinIO as \ud83d\udce6 MinIO\r\n    participant FlatList as \ud83d\udccb FlatList\r\n\r\n    User->>HomeUI: Acessa Home\r\n    HomeUI->>API: GET /api/Items (inicial)\r\n    Backend->>DB: SELECT FROM Items\r\n    DB--\x3e>Backend: Items + Fotos\r\n    \r\n    loop Para cada foto\r\n        Backend->>MinIO: GetPresignedUrl(path)\r\n        MinIO--\x3e>Backend: Signed URL\r\n    end\r\n    \r\n    Backend--\x3e>API: [{id, nome, fotos: [urls]}]\r\n    API--\x3e>HomeUI: Items carregados\r\n    HomeUI->>FlatList: Renderiza 2 colunas\r\n    HomeUI--\x3e>User: Grid exibido\r\n    \r\n    FlatList->>FlatList: Virtualiza\xe7\xe3o ativa\r\n    User->>User: Scroll para cima\r\n    User->>RefreshControl: Pull-to-refresh\r\n    \r\n    RefreshControl->>RefreshControl: setRefreshing(true)\r\n    RefreshControl->>HomeUI: onRefresh()\r\n    \r\n    HomeUI->>API: GET /api/Items (refresh)\r\n    Backend->>DB: SELECT FROM Items\r\n    DB--\x3e>Backend: Items atualizados\r\n    Backend--\x3e>API: Data\r\n    API--\x3e>HomeUI: response.data\r\n    \r\n    HomeUI->>HomeUI: setItems(data)\r\n    HomeUI->>RefreshControl: setRefreshing(false)\r\n    \r\n    FlatList->>FlatList: Re-renderiza\r\n    RefreshControl->>UI: Loading desaparece\r\n    HomeUI--\x3e>User: Grid atualizado \u2713"}),"\n",(0,o.jsx)(r.hr,{}),"\n",(0,o.jsx)(r.h2,{id:"-interceptor-de-requisi\xe7\xf5es",children:"\ud83c\udfa8 Interceptor de Requisi\xe7\xf5es"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-typescript",children:"// services/API.ts - Interceptor autom\xe1tico\r\n\r\napi.interceptors.request.use(\r\n  async (config) => {\r\n    // 1. Adiciona token\r\n    const token = await SecureStore.getItemAsync('token');\r\n    \r\n    if (token) {\r\n      // 2. Valida expira\xe7\xe3o\r\n      const [provider, cleanToken] = token.split('_OC_');\r\n      config.headers.Authorization = `Bearer ${cleanToken}`;\r\n    }\r\n    \r\n    // 3. Headers customizados\r\n    config.headers['X-Requested-With'] = 'XMLHttpRequest';\r\n    \r\n    // 4. Timeout por tipo\r\n    if (config.url?.includes('/Clasificar')) {\r\n      config.timeout = 30000; // 30s para IA\r\n    }\r\n    \r\n    return config;\r\n  },\r\n  (error) => Promise.reject(error)\r\n);\r\n\r\napi.interceptors.response.use(\r\n  (response) => response,\r\n  async (error) => {\r\n    // Trata erros\r\n    if (error.response?.status === 401) {\r\n      // Logout autom\xe1tico\r\n      await SecureStore.deleteItemAsync('token');\r\n      router.replace('/login');\r\n    }\r\n    return Promise.reject(error);\r\n  }\r\n);\n"})}),"\n",(0,o.jsx)(r.hr,{}),"\n",(0,o.jsx)(r.h2,{id:"-lazy-loading-de-imagens",children:"\ud83d\udcf1 Lazy Loading de Imagens"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-typescript",children:"// Otimiza\xe7\xe3o para galeria\r\n\r\ninterface ItemCardProps {\r\n  item: Item;\r\n}\r\n\r\nexport function ItemCard({ item }: ItemCardProps) {\r\n  const [loaded, setLoaded] = useState(false);\r\n  const imgRef = useRef<Image>(null);\r\n\r\n  useEffect(() => {\r\n    // Intersection Observer mobile\r\n    const handleViewableItemsChanged = ({\r\n      viewableItems,\r\n    }: ViewableItemsChanged) => {\r\n      viewableItems.forEach((item) => {\r\n        if (item.item.id === item.id && imgRef.current) {\r\n          // Inicia carregamento\r\n          setLoaded(true);\r\n        }\r\n      });\r\n    };\r\n\r\n    return () => {\r\n      // Cleanup\r\n    };\r\n  }, [item.id]);\r\n\r\n  return (\r\n    <View style={styles.card}>\r\n      {!loaded && <ActivityIndicator />}\r\n      <Image\r\n        ref={imgRef}\r\n        source={{ uri: loaded ? item.fotos[0] : undefined }}\r\n        style={styles.image}\r\n        onLoad={() => setLoaded(true)}\r\n      />\r\n      <Text style={styles.title}>{item.nome}</Text>\r\n    </View>\r\n  );\r\n}\n"})}),"\n",(0,o.jsx)(r.hr,{}),"\n",(0,o.jsx)(r.h2,{id:"-seguran\xe7a-com-deep-linking",children:"\ud83d\udd10 Seguran\xe7a com Deep Linking"}),"\n",(0,o.jsx)(r.pre,{children:(0,o.jsx)(r.code,{className:"language-json",children:'{\r\n  "scheme": "ocolecionadormobile",\r\n  "plugins": [\r\n    [\r\n      "expo-router",\r\n      {\r\n        "origin": "https://seu-backend.com"\r\n      }\r\n    ]\r\n  ],\r\n  "intentFilters": [\r\n    {\r\n      "action": "VIEW",\r\n      "data": [\r\n        {\r\n          "scheme": "https",\r\n          "host": "seu-backend.com",\r\n          "pathPrefix": "/auth"\r\n        }\r\n      ],\r\n      "category": ["BROWSABLE", "DEFAULT"]\r\n    }\r\n  ]\r\n}\n'})}),"\n",(0,o.jsx)(r.hr,{}),"\n",(0,o.jsx)(r.h2,{id:"-diagrama-de-navega\xe7\xe3o-mobile",children:"\ud83d\udcca Diagrama de Navega\xe7\xe3o Mobile"}),"\n",(0,o.jsx)(r.mermaid,{value:'graph TD\r\n    A["RootLayout"]\r\n    A --\x3e|Sem token| B["AuthStack"]\r\n    B --\x3e B1["Login.tsx<br/>(OAuth2 + Deep Link)"]\r\n    \r\n    A --\x3e|Com token| C["TabsStack<br/>(Bottom Tabs)"]\r\n    \r\n    C --\x3e C1["home.tsx<br/>(FlatList 2 cols)"]\r\n    C --\x3e C2["newItem.tsx<br/>(Form + Upload)"]\r\n    C --\x3e C3["classify.tsx<br/>(Camera + IA)"]\r\n    C --\x3e C4["account.tsx<br/>(Perfil)"]\r\n    \r\n    B1 --\x3e|Token salvo| C\r\n    \r\n    style A fill:#e1f5ff\r\n    style B fill:#fff3e0\r\n    style C fill:#f3e5f5\r\n    style C1 fill:#e8f5e9\r\n    style C2 fill:#e8f5e9\r\n    style C3 fill:#e8f5e9\r\n    style C4 fill:#e8f5e9'}),"\n",(0,o.jsx)(r.hr,{}),"\n",(0,o.jsx)(r.h2,{id:"-performance-checklist",children:"\ud83d\udcc8 Performance Checklist"}),"\n",(0,o.jsxs)(r.p,{children:["\u2705 ",(0,o.jsx)(r.strong,{children:"FlatList Virtualizado"})," \u2013 Apenas itens vis\xedveis renderizados",(0,o.jsx)(r.br,{}),"\n","\u2705 ",(0,o.jsx)(r.strong,{children:"Lazy Loading"})," \u2013 Imagens carregam sob demanda",(0,o.jsx)(r.br,{}),"\n","\u2705 ",(0,o.jsx)(r.strong,{children:"Memoization"})," \u2013 React.memo em componentes de item",(0,o.jsx)(r.br,{}),"\n","\u2705 ",(0,o.jsx)(r.strong,{children:"Cache"})," \u2013 AsyncStorage para dados locais",(0,o.jsx)(r.br,{}),"\n","\u2705 ",(0,o.jsx)(r.strong,{children:"Compress\xe3o"})," \u2013 Fotos comprimidas antes de upload",(0,o.jsx)(r.br,{}),"\n","\u2705 ",(0,o.jsx)(r.strong,{children:"Timeout Otimizado"})," \u2013 30s para IA, 10s para API"]}),"\n",(0,o.jsx)(r.hr,{}),"\n",(0,o.jsx)(r.h2,{id:"-conclus\xe3o",children:"\ud83c\udfaf Conclus\xe3o"}),"\n",(0,o.jsxs)(r.p,{children:["O ",(0,o.jsx)(r.strong,{children:"OColecionadorMobile"})," implementa:"]}),"\n",(0,o.jsxs)(r.p,{children:["\u2705 ",(0,o.jsx)(r.strong,{children:"Autentica\xe7\xe3o segura"})," com OAuth2 + deep linking",(0,o.jsx)(r.br,{}),"\n","\u2705 ",(0,o.jsx)(r.strong,{children:"Captura nativa"})," de fotos com c\xe2mera/galeria",(0,o.jsx)(r.br,{}),"\n","\u2705 ",(0,o.jsx)(r.strong,{children:"Classifica\xe7\xe3o em tempo real"})," com TensorFlow",(0,o.jsx)(r.br,{}),"\n","\u2705 ",(0,o.jsx)(r.strong,{children:"Sincroniza\xe7\xe3o eficiente"})," com pull-to-refresh",(0,o.jsx)(r.br,{}),"\n","\u2705 ",(0,o.jsx)(r.strong,{children:"Performance otimizada"})," para dispositivos m\xf3veis",(0,o.jsx)(r.br,{}),"\n","\u2705 ",(0,o.jsx)(r.strong,{children:"UX intuitiva"})," com bottom tabs navigation"]}),"\n",(0,o.jsx)(r.p,{children:"Todos os fluxos s\xe3o testados e prontos para produ\xe7\xe3o em iOS e Android via Expo."})]})}function m(e={}){const{wrapper:r}={...(0,i.R)(),...e.components};return r?(0,o.jsx)(r,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}}}]);