"use strict";(globalThis.webpackChunkdocumentation=globalThis.webpackChunkdocumentation||[]).push([[579],{4962:(n,r,e)=>{e.r(r),e.d(r,{assets:()=>l,contentTitle:()=>t,default:()=>m,frontMatter:()=>o,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"ocolecionadortraining","title":"OColecionadorTraining","description":"\ud83d\udccb Vis\xe3o Geral","source":"@site/docs/ocolecionadortraining.md","sourceDirName":".","slug":"/ocolecionadortraining","permalink":"/OColecionador/docs/ocolecionadortraining","draft":false,"unlisted":false,"editUrl":"https://github.com/PatrickCalorioCarvalho/OColecionador/edit/main/Documentation/docs/docs/ocolecionadortraining.md","tags":[],"version":"current","frontMatter":{"id":"ocolecionadortraining","title":"OColecionadorTraining","sidebar_label":"Introdu\xe7\xe3o"},"sidebar":"docs","previous":{"title":"Avan\xe7ado","permalink":"/OColecionador/docs/ocolecionadorclassifier-advanced"},"next":{"title":"Avan\xe7ado","permalink":"/OColecionador/docs/ocolecionadortraining-advanced"}}');var i=e(4848),s=e(8453);const o={id:"ocolecionadortraining",title:"OColecionadorTraining",sidebar_label:"Introdu\xe7\xe3o"},t="OColecionadorTraining \ud83c\udf93",l={},d=[{value:"\ud83d\udccb Vis\xe3o Geral",id:"-vis\xe3o-geral",level:2},{value:"Responsabilidades Principais",id:"responsabilidades-principais",level:3},{value:"\ud83c\udfd7\ufe0f Arquitetura",id:"\ufe0f-arquitetura",level:2},{value:"Estrutura de Pastas",id:"estrutura-de-pastas",level:3},{value:"\ud83d\udce6 Depend\xeancias Principais",id:"-depend\xeancias-principais",level:2},{value:"\ud83d\udd0c Fluxo Principal",id:"-fluxo-principal",level:2},{value:"\ud83e\udde0 Arquitetura do Modelo de Treinamento",id:"-arquitetura-do-modelo-de-treinamento",level:2},{value:"Transfer Learning com MobileNetV2",id:"transfer-learning-com-mobilenetv2",level:3},{value:"Estrat\xe9gias de Treinamento",id:"estrat\xe9gias-de-treinamento",level:3},{value:"\ud83d\udce8 Formato de Mensagem RabbitMQ",id:"-formato-de-mensagem-rabbitmq",level:2},{value:"Input (Consumo)",id:"input-consumo",level:3},{value:"Output (Publica\xe7\xe3o ap\xf3s sucesso)",id:"output-publica\xe7\xe3o-ap\xf3s-sucesso",level:3},{value:"\ud83d\uddc4\ufe0f Estrutura de Dados PostgreSQL",id:"\ufe0f-estrutura-de-dados-postgresql",level:2},{value:"Tabela: training_jobs",id:"tabela-training_jobs",level:3},{value:"Tabela: training_metrics",id:"tabela-training_metrics",level:3},{value:"Tabela: model_versions",id:"tabela-model_versions",level:3},{value:"Tabela: hyperparameters",id:"tabela-hyperparameters",level:3},{value:"\ud83d\udd27 Configura\xe7\xe3o",id:"-configura\xe7\xe3o",level:2},{value:"Vari\xe1veis de Ambiente (.env)",id:"vari\xe1veis-de-ambiente-env",level:3},{value:"config.yaml",id:"configyaml",level:3},{value:"\ud83d\ude80 Estrutura de C\xf3digo (main.py)",id:"-estrutura-de-c\xf3digo-mainpy",level:2},{value:"\ud83d\udc33 Docker",id:"-docker",level:2},{value:"Dockerfile",id:"dockerfile",level:3},{value:"requirements.txt",id:"requirementstxt",level:3},{value:"\ud83d\udcca Exemplo de Fluxo Completo",id:"-exemplo-de-fluxo-completo",level:2},{value:"\u26a1 Performance",id:"-performance",level:2},{value:"\ud83c\udfaf Conclus\xe3o",id:"-conclus\xe3o",level:2}];function c(n){const r={br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.header,{children:(0,i.jsx)(r.h1,{id:"ocolecionadortraining-",children:"OColecionadorTraining \ud83c\udf93"})}),"\n",(0,i.jsx)(r.h2,{id:"-vis\xe3o-geral",children:"\ud83d\udccb Vis\xe3o Geral"}),"\n",(0,i.jsxs)(r.p,{children:["O ",(0,i.jsx)(r.strong,{children:"OColecionadorTraining"})," \xe9 um servi\xe7o Python de ",(0,i.jsx)(r.strong,{children:"treinamento de modelos de Deep Learning"})," que funciona como um ",(0,i.jsx)(r.strong,{children:"orquestrador de pipelines de IA"}),". Ele:"]}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["\ud83d\udce8 ",(0,i.jsx)(r.strong,{children:"Consome mensagens"})," do RabbitMQ (fila: ModelTraining)"]}),"\n",(0,i.jsxs)(r.li,{children:["\ud83d\udce5 ",(0,i.jsx)(r.strong,{children:"Baixa dataset aumentado"})," do MinIO (bucket: processed)"]}),"\n",(0,i.jsxs)(r.li,{children:["\ud83c\udfaf ",(0,i.jsx)(r.strong,{children:"Treina modelos"})," TensorFlow/Keras (MobileNetV2)"]}),"\n",(0,i.jsxs)(r.li,{children:["\ud83d\udcca ",(0,i.jsx)(r.strong,{children:"Calcula m\xe9tricas"})," (Accuracy, Precision, Recall, F1)"]}),"\n",(0,i.jsxs)(r.li,{children:["\ud83d\udcbe ",(0,i.jsx)(r.strong,{children:"Registra hist\xf3rico"})," no PostgreSQL"]}),"\n",(0,i.jsxs)(r.li,{children:["\ud83d\udce4 ",(0,i.jsx)(r.strong,{children:"Salva modelos"})," no MinIO e filesystem"]}),"\n",(0,i.jsxs)(r.li,{children:["\ud83c\udfb2 ",(0,i.jsx)(r.strong,{children:"Gerencia vers\xf5es"})," de modelos (v1, v2, v3...)"]}),"\n",(0,i.jsxs)(r.li,{children:["\u26a1 ",(0,i.jsx)(r.strong,{children:"Suporta GPU"})," para acelerar treinamento"]}),"\n",(0,i.jsxs)(r.li,{children:["\ud83d\udcc8 ",(0,i.jsx)(r.strong,{children:"Monitora progresso"})," com callbacks"]}),"\n"]}),"\n",(0,i.jsx)(r.h3,{id:"responsabilidades-principais",children:"Responsabilidades Principais"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["\ud83d\udd14 ",(0,i.jsx)(r.strong,{children:"Consumo de Fila"})," \u2013 Escuta mensagens de novos datasets"]}),"\n",(0,i.jsxs)(r.li,{children:["\ud83d\udce5 ",(0,i.jsx)(r.strong,{children:"Data Loading"})," \u2013 Carrega e valida imagens do MinIO"]}),"\n",(0,i.jsxs)(r.li,{children:["\ud83d\udd00 ",(0,i.jsx)(r.strong,{children:"Data Augmentation"})," \u2013 Aplica\xe7\xf5es em tempo de treinamento"]}),"\n",(0,i.jsxs)(r.li,{children:["\ud83e\udde0 ",(0,i.jsx)(r.strong,{children:"Transfer Learning"})," \u2013 Fine-tuning de MobileNetV2"]}),"\n",(0,i.jsxs)(r.li,{children:["\ud83d\udcca ",(0,i.jsx)(r.strong,{children:"Valida\xe7\xe3o"})," \u2013 Avalia modelo em validation set"]}),"\n",(0,i.jsxs)(r.li,{children:["\ud83c\udfaf ",(0,i.jsx)(r.strong,{children:"Hyperparameter Tuning"})," \u2013 Grid search/random search"]}),"\n",(0,i.jsxs)(r.li,{children:["\ud83d\udcbe ",(0,i.jsx)(r.strong,{children:"Model Versioning"})," \u2013 Salva checkpoints e best model"]}),"\n",(0,i.jsxs)(r.li,{children:["\ud83d\udcc8 ",(0,i.jsx)(r.strong,{children:"Logging de M\xe9tricas"})," \u2013 TensorBoard, WandB, custom"]}),"\n",(0,i.jsxs)(r.li,{children:["\ud83d\udd04 ",(0,i.jsx)(r.strong,{children:"Retry Logic"})," \u2013 Reprocessa falhas com backoff"]}),"\n"]}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"\ufe0f-arquitetura",children:"\ud83c\udfd7\ufe0f Arquitetura"}),"\n",(0,i.jsx)(r.h3,{id:"estrutura-de-pastas",children:"Estrutura de Pastas"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"OColecionadorTraining/\r\n\u251c\u2500\u2500 main.py                          # Ponto de entrada\r\n\u251c\u2500\u2500 requirements.txt                 # Depend\xeancias Python\r\n\u251c\u2500\u2500 Dockerfile                       # Imagem Docker\r\n\u251c\u2500\u2500 init_db.sql                     # Schema PostgreSQL\r\n\u251c\u2500\u2500 config.yaml                     # Configura\xe7\xe3o de treinamento\r\n\u251c\u2500\u2500 models/\r\n\u2502   \u251c\u2500\u2500 v1/\r\n\u2502   \u2502   \u251c\u2500\u2500 model.h5               # Modelo treinado\r\n\u2502   \u2502   \u251c\u2500\u2500 weights.h5             # Pesos\r\n\u2502   \u2502   \u251c\u2500\u2500 training_log.csv       # Hist\xf3rico\r\n\u2502   \u2502   \u2514\u2500\u2500 metadata.json\r\n\u2502   \u2514\u2500\u2500 v2/\r\n\u2502       \u251c\u2500\u2500 model.h5\r\n\u2502       \u251c\u2500\u2500 weights.h5\r\n\u2502       \u2514\u2500\u2500 metadata.json\r\n\u251c\u2500\u2500 datasets/\r\n\u2502   \u251c\u2500\u2500 train/\r\n\u2502   \u2502   \u251c\u2500\u2500 carros/\r\n\u2502   \u2502   \u251c\u2500\u2500 moedas/\r\n\u2502   \u2502   \u2514\u2500\u2500 animais/\r\n\u2502   \u251c\u2500\u2500 val/\r\n\u2502   \u2514\u2500\u2500 test/\r\n\u251c\u2500\u2500 logs/\r\n\u2502   \u251c\u2500\u2500 tensorboard/\r\n\u2502   \u251c\u2500\u2500 training.log\r\n\u2502   \u2514\u2500\u2500 metrics.json\r\n\u2514\u2500\u2500 [m\xf3dulos Python esperados]\r\n    \u251c\u2500\u2500 config.py                   # Configura\xe7\xf5es\r\n    \u251c\u2500\u2500 rabbitmq_consumer.py        # Consumer RabbitMQ\r\n    \u251c\u2500\u2500 data_loader.py              # Data pipeline\r\n    \u251c\u2500\u2500 minio_handler.py            # Handler MinIO\r\n    \u251c\u2500\u2500 model_builder.py            # Constru\xe7\xe3o de modelos\r\n    \u251c\u2500\u2500 training_engine.py          # Motor de treinamento\r\n    \u251c\u2500\u2500 validators.py               # Valida\xe7\xe3o\r\n    \u251c\u2500\u2500 database.py                 # Conex\xe3o PostgreSQL\r\n    \u251c\u2500\u2500 callbacks.py                # Custom callbacks\r\n    \u2514\u2500\u2500 logger.py                   # Logging centralizado\n"})}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"-depend\xeancias-principais",children:"\ud83d\udce6 Depend\xeancias Principais"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-txt",children:"Python 3.11+\r\n\u251c\u2500\u2500 tensorflow                  # Deep learning framework\r\n\u251c\u2500\u2500 keras                       # Neural network API\r\n\u251c\u2500\u2500 numpy                       # Computa\xe7\xe3o num\xe9rica\r\n\u251c\u2500\u2500 pandas                      # Data manipulation\r\n\u251c\u2500\u2500 pillow                      # Processamento de imagens\r\n\u251c\u2500\u2500 opencv-python              # Vis\xe3o computacional\r\n\u251c\u2500\u2500 scikit-learn               # ML utilities\r\n\u251c\u2500\u2500 pika                       # RabbitMQ Client\r\n\u251c\u2500\u2500 minio                      # MinIO/S3 Client\r\n\u251c\u2500\u2500 psycopg2-binary            # PostgreSQL Client\r\n\u251c\u2500\u2500 python-dotenv              # Vari\xe1veis de ambiente\r\n\u251c\u2500\u2500 tensorboard                # Visualization\r\n\u251c\u2500\u2500 wandb                      # Experiment tracking\r\n\u251c\u2500\u2500 matplotlib                 # Plotting\r\n\u2514\u2500\u2500 requests                   # HTTP client\n"})}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"-fluxo-principal",children:"\ud83d\udd0c Fluxo Principal"}),"\n",(0,i.jsx)(r.mermaid,{value:'graph LR\r\n    A["\ud83d\udce8 RabbitMQ<br/>fila: ModelTraining"] --\x3e|Mensagem| B["\ud83c\udf93 Training Service"]\r\n    B --\x3e|Download| C["\ud83d\udce6 MinIO<br/>bucket: processed"]\r\n    B --\x3e|Load| D["\ud83d\udcca Data Pipeline"]\r\n    D --\x3e|Train/Val split| E["\ud83d\udd00 Generators"]\r\n    E --\x3e|Batch processing| F["\ud83e\udde0 TensorFlow Model"]\r\n    F --\x3e|Callbacks| G["\ud83d\udcc8 TensorBoard"]\r\n    F --\x3e|Save| H["\ud83d\udcbe Best Checkpoint"]\r\n    H --\x3e|Upload| I["\ud83d\udce6 MinIO<br/>bucket: models"]\r\n    F --\x3e|Metrics| J["\ud83d\udcbe PostgreSQL"]\r\n    J --\x3e|Query| K["\ud83d\udcca Dashboard"]'}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"-arquitetura-do-modelo-de-treinamento",children:"\ud83e\udde0 Arquitetura do Modelo de Treinamento"}),"\n",(0,i.jsx)(r.h3,{id:"transfer-learning-com-mobilenetv2",children:"Transfer Learning com MobileNetV2"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"Input: 224x224x3 (RGB)\r\n    \u2193\r\n[MobileNetV2 - Weights pr\xe9-treinados (ImageNet)]\r\n    \u251c\u2500 Depthwise Separable Convolutions\r\n    \u251c\u2500 BatchNormalization\r\n    \u251c\u2500 Linear Bottleneck\r\n    \u2514\u2500 Inverted Residual blocks\r\n    \u2193\r\nGlobal Average Pooling (1280D)\r\n    \u2193\r\nDense(512, activation='relu') [Fine-tune]\r\n    \u2193\r\nDropout(0.5) [Regulariza\xe7\xe3o]\r\n    \u2193\r\nDense(num_classes, activation='softmax') [Fine-tune]\r\n    \u2193\r\nOutput: [prob_classe1, prob_classe2, ..., prob_classeN]\n"})}),"\n",(0,i.jsx)(r.h3,{id:"estrat\xe9gias-de-treinamento",children:"Estrat\xe9gias de Treinamento"}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Phase 1: Feature Extraction (Congelado)"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"MobileNetV2 base: frozen=True\r\nTop layers: trainable\r\nLearning rate: 1e-3\r\nEpochs: 10\n"})}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Phase 2: Fine-tuning (Descongelado)"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"MobileNetV2 base: frozen=False (\xfaltimas 50 layers)\r\nTop layers: trainable\r\nLearning rate: 1e-5\r\nEpochs: 20\n"})}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"-formato-de-mensagem-rabbitmq",children:"\ud83d\udce8 Formato de Mensagem RabbitMQ"}),"\n",(0,i.jsx)(r.h3,{id:"input-consumo",children:"Input (Consumo)"}),"\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.strong,{children:"Fila:"})," ",(0,i.jsx)(r.code,{children:"ModelTraining"})]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-json",children:'{\r\n  "batchId": "batch_20251115_001",\r\n  "totalImages": 450,\r\n  "categories": ["carros", "moedas", "animais"],\r\n  "augmentationCount": 9,\r\n  "datasetPath": "training/carros/",\r\n  "targetClasses": 50,\r\n  "priority": "high",\r\n  "createdAt": "2025-11-15T10:00:00Z"\r\n}\n'})}),"\n",(0,i.jsx)(r.h3,{id:"output-publica\xe7\xe3o-ap\xf3s-sucesso",children:"Output (Publica\xe7\xe3o ap\xf3s sucesso)"}),"\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.strong,{children:"Fila:"})," ",(0,i.jsx)(r.code,{children:"ModelEvaluation"})]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-json",children:'{\r\n  "modelVersion": "v3_20251115_143022",\r\n  "trainingStatus": "success",\r\n  "metrics": {\r\n    "accuracy": 0.9412,\r\n    "precision": 0.9387,\r\n    "recall": 0.9301,\r\n    "f1_score": 0.9344,\r\n    "loss": 0.1823\r\n  },\r\n  "trainingTime": 3600,\r\n  "epochsCompleted": 30,\r\n  "bestEpoch": 28,\r\n  "modelPath": "models/v3_20251115_143022/model.h5",\r\n  "metricsPath": "models/v3_20251115_143022/metrics.json",\r\n  "embeddingsPath": "models/v3_20251115_143022/embeddings.faiss",\r\n  "completedAt": "2025-11-15T11:00:00Z"\r\n}\n'})}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"\ufe0f-estrutura-de-dados-postgresql",children:"\ud83d\uddc4\ufe0f Estrutura de Dados PostgreSQL"}),"\n",(0,i.jsx)(r.h3,{id:"tabela-training_jobs",children:"Tabela: training_jobs"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-sql",children:"CREATE TABLE training_jobs (\r\n    id SERIAL PRIMARY KEY,\r\n    batch_id VARCHAR(100) UNIQUE NOT NULL,\r\n    model_version VARCHAR(50) UNIQUE,\r\n    status VARCHAR(20), -- pending, training, validating, success, failed\r\n    total_images INT,\r\n    total_categories INT,\r\n    augmentation_count INT,\r\n    target_accuracy DECIMAL(5, 4),\r\n    achieved_accuracy DECIMAL(5, 4),\r\n    achieved_precision DECIMAL(5, 4),\r\n    achieved_recall DECIMAL(5, 4),\r\n    achieved_f1 DECIMAL(5, 4),\r\n    training_time_seconds INT,\r\n    epochs_completed INT,\r\n    best_epoch INT,\r\n    early_stopping_patience INT DEFAULT 5,\r\n    stopped_reason VARCHAR(100),\r\n    error_message TEXT,\r\n    attempts INT DEFAULT 0,\r\n    max_attempts INT DEFAULT 2,\r\n    model_path VARCHAR(255),\r\n    metrics_path VARCHAR(255),\r\n    embeddings_path VARCHAR(255),\r\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\r\n    started_at TIMESTAMP,\r\n    completed_at TIMESTAMP,\r\n    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\r\n);\n"})}),"\n",(0,i.jsx)(r.h3,{id:"tabela-training_metrics",children:"Tabela: training_metrics"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-sql",children:"CREATE TABLE training_metrics (\r\n    id SERIAL PRIMARY KEY,\r\n    job_id INT REFERENCES training_jobs(id),\r\n    epoch INT,\r\n    loss DECIMAL(8, 6),\r\n    accuracy DECIMAL(5, 4),\r\n    val_loss DECIMAL(8, 6),\r\n    val_accuracy DECIMAL(5, 4),\r\n    precision DECIMAL(5, 4),\r\n    recall DECIMAL(5, 4),\r\n    f1_score DECIMAL(5, 4),\r\n    learning_rate DECIMAL(10, 8),\r\n    duration_seconds INT,\r\n    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP\r\n);\n"})}),"\n",(0,i.jsx)(r.h3,{id:"tabela-model_versions",children:"Tabela: model_versions"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-sql",children:"CREATE TABLE model_versions (\r\n    id SERIAL PRIMARY KEY,\r\n    model_version VARCHAR(50) UNIQUE,\r\n    accuracy DECIMAL(5, 4),\r\n    precision DECIMAL(5, 4),\r\n    recall DECIMAL(5, 4),\r\n    f1_score DECIMAL(5, 4),\r\n    is_production BOOLEAN DEFAULT FALSE,\r\n    is_active BOOLEAN DEFAULT FALSE,\r\n    deployment_date TIMESTAMP,\r\n    model_path VARCHAR(255),\r\n    total_parameters INT,\r\n    inference_time_ms DECIMAL(6, 2),\r\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\r\n);\n"})}),"\n",(0,i.jsx)(r.h3,{id:"tabela-hyperparameters",children:"Tabela: hyperparameters"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-sql",children:"CREATE TABLE hyperparameters (\r\n    id SERIAL PRIMARY KEY,\r\n    job_id INT REFERENCES training_jobs(id),\r\n    batch_size INT,\r\n    learning_rate DECIMAL(10, 8),\r\n    optimizer VARCHAR(50), -- adam, sgd, rmsprop\r\n    loss_function VARCHAR(50), -- categorical_crossentropy\r\n    epochs INT,\r\n    early_stopping_patience INT,\r\n    dropout_rate DECIMAL(3, 2),\r\n    l1_regularization DECIMAL(10, 8),\r\n    l2_regularization DECIMAL(10, 8),\r\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\r\n);\n"})}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"-configura\xe7\xe3o",children:"\ud83d\udd27 Configura\xe7\xe3o"}),"\n",(0,i.jsx)(r.h3,{id:"vari\xe1veis-de-ambiente-env",children:"Vari\xe1veis de Ambiente (.env)"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-bash",children:"# RabbitMQ\r\nRABBITMQ_HOST=rabbitmq\r\nRABBITMQ_PORT=5672\r\nRABBITMQ_USER=OColecionadorUser\r\nRABBITMQ_PASSWORD=OColecionador@2025\r\nRABBITMQ_QUEUE=ModelTraining\r\nRABBITMQ_OUTPUT_QUEUE=ModelEvaluation\r\n\r\n# MinIO\r\nMINIO_HOST=minio\r\nMINIO_PORT=9000\r\nMINIO_ACCESS_KEY=OColecionadorUser\r\nMINIO_SECRET_KEY=OColecionador@2025\r\nMINIO_BUCKET_PROCESSED=ocolecionadorbucket-processed\r\nMINIO_BUCKET_MODELS=ocolecionadorbucket-models\r\n\r\n# PostgreSQL\r\nDB_HOST=postgres\r\nDB_PORT=5432\r\nDB_NAME=training_db\r\nDB_USER=OColecionadorUser\r\nDB_PASSWORD=OColecionador@2025\r\n\r\n# TensorFlow\r\nTF_CPP_MIN_LOG_LEVEL=2\r\nCUDA_VISIBLE_DEVICES=0  # GPU device\r\nTF_FORCE_GPU_ALLOW_GROWTH=true\r\n\r\n# Treinamento\r\nBATCH_SIZE=32\r\nEPOCHS=30\r\nLEARNING_RATE=0.001\r\nEARLY_STOPPING_PATIENCE=5\r\nVALIDATION_SPLIT=0.2\r\nTEST_SPLIT=0.1\r\n\r\n# Logging\r\nLOG_LEVEL=INFO\r\nLOG_FILE=/logs/training.log\r\nTENSORBOARD_LOG_DIR=/logs/tensorboard\r\nWANDB_ENABLED=true\r\nWANDB_PROJECT=ocolecionador\r\nWANDB_API_KEY=<sua_chave_wandb>\n"})}),"\n",(0,i.jsx)(r.h3,{id:"configyaml",children:"config.yaml"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-yaml",children:"# config.yaml - Configura\xe7\xe3o de treinamento\r\n\r\nmodel:\r\n  name: MobileNetV2\r\n  input_size: 224\r\n  pooling: global_average\r\n  weights: imagenet  # pr\xe9-treinado\r\n\r\ntraining:\r\n  phase1:\r\n    epochs: 10\r\n    learning_rate: 0.001\r\n    freeze_base: true\r\n    \r\n  phase2:\r\n    epochs: 20\r\n    learning_rate: 0.00001\r\n    freeze_base: false\r\n    freeze_until_layer: 100\r\n\r\noptimizer:\r\n  name: adam\r\n  beta_1: 0.9\r\n  beta_2: 0.999\r\n  epsilon: 1e-7\r\n\r\nloss:\r\n  function: categorical_crossentropy\r\n  \r\nregularization:\r\n  dropout: 0.5\r\n  l1: 0.0001\r\n  l2: 0.0001\r\n\r\ndata:\r\n  batch_size: 32\r\n  validation_split: 0.2\r\n  test_split: 0.1\r\n  shuffle: true\r\n  augmentation:\r\n    rotation_range: 20\r\n    width_shift_range: 0.2\r\n    height_shift_range: 0.2\r\n    horizontal_flip: true\r\n    zoom_range: 0.2\r\n    \r\ncallbacks:\r\n  early_stopping:\r\n    monitor: val_loss\r\n    patience: 5\r\n    restore_best: true\r\n    \r\n  model_checkpoint:\r\n    monitor: val_accuracy\r\n    save_best_only: true\r\n    \r\n  reduce_lr:\r\n    monitor: val_loss\r\n    factor: 0.1\r\n    patience: 3\r\n    min_lr: 1e-7\r\n    \r\ntensorboard:\r\n  enabled: true\r\n  histogram_freq: 1\n"})}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"-estrutura-de-c\xf3digo-mainpy",children:"\ud83d\ude80 Estrutura de C\xf3digo (main.py)"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-python",children:'# main.py - Ponto de entrada\r\n\r\nimport pika\r\nimport json\r\nimport logging\r\nimport tensorflow as tf\r\nfrom tensorflow import keras\r\nimport numpy as np\r\nimport psycopg2\r\nfrom datetime import datetime\r\nimport time\r\n\r\n# Configura\xe7\xe3o\r\nRABBITMQ_URL = f"amqp://{RABBITMQ_USER}:{RABBITMQ_PASSWORD}@{RABBITMQ_HOST}:{RABBITMQ_PORT}/"\r\nINPUT_QUEUE = "ModelTraining"\r\nOUTPUT_QUEUE = "ModelEvaluation"\r\n\r\n# Conex\xf5es\r\ndb_connection = psycopg2.connect(...)\r\n\r\ndef process_training_message(ch, method, properties, body):\r\n    """Callback para processar mensagem de treinamento"""\r\n    job_id = None\r\n    try:\r\n        message = json.loads(body)\r\n        batch_id = message[\'batchId\']\r\n        total_images = message[\'totalImages\']\r\n        categories = message[\'categories\']\r\n        \r\n        # 1. Criar registro no banco\r\n        job_id = create_training_job(batch_id, total_images, len(categories))\r\n        \r\n        # 2. Baixar dataset do MinIO\r\n        dataset_path = download_dataset_from_minio(batch_id)\r\n        \r\n        # 3. Carregar e preparar dados\r\n        train_gen, val_gen, num_classes = prepare_data_generators(\r\n            dataset_path,\r\n            batch_size=32,\r\n            validation_split=0.2\r\n        )\r\n        \r\n        # 4. Construir modelo\r\n        model = build_model(num_classes=num_classes)\r\n        \r\n        # 5. Compilar modelo\r\n        model.compile(\r\n            optimizer=keras.optimizers.Adam(learning_rate=0.001),\r\n            loss=\'categorical_crossentropy\',\r\n            metrics=[\'accuracy\', keras.metrics.Precision(), keras.metrics.Recall()]\r\n        )\r\n        \r\n        # 6. Definir callbacks\r\n        callbacks = [\r\n            keras.callbacks.EarlyStopping(\r\n                monitor=\'val_loss\',\r\n                patience=5,\r\n                restore_best_weights=True\r\n            ),\r\n            keras.callbacks.ReduceLROnPlateau(\r\n                monitor=\'val_loss\',\r\n                factor=0.1,\r\n                patience=3,\r\n                min_lr=1e-7\r\n            ),\r\n            keras.callbacks.TensorBoard(\r\n                log_dir=\'./logs/tensorboard\',\r\n                histogram_freq=1\r\n            ),\r\n            CustomMetricsCallback(job_id)\r\n        ]\r\n        \r\n        # 7. Treinar modelo\r\n        start_time = time.time()\r\n        \r\n        history = model.fit(\r\n            train_gen,\r\n            epochs=30,\r\n            validation_data=val_gen,\r\n            callbacks=callbacks,\r\n            verbose=1\r\n        )\r\n        \r\n        training_time = time.time() - start_time\r\n        \r\n        # 8. Avaliar no test set\r\n        test_metrics = evaluate_model(model, job_id)\r\n        \r\n        # 9. Salvar modelo\r\n        model_version = f"v{get_version_number()}_{datetime.now().strftime(\'%Y%m%d_%H%M%S\')}"\r\n        model_path = save_model(model, model_version)\r\n        \r\n        # 10. Upload para MinIO\r\n        minio_path = upload_model_to_minio(model_path, model_version)\r\n        \r\n        # 11. Registrar sucesso no banco\r\n        update_training_job_success(\r\n            job_id,\r\n            model_version,\r\n            test_metrics,\r\n            training_time\r\n        )\r\n        \r\n        # 12. Publicar resultado\r\n        publish_training_result(\r\n            model_version,\r\n            test_metrics,\r\n            minio_path,\r\n            \'success\'\r\n        )\r\n        \r\n        # 13. ACK da mensagem\r\n        ch.basic_ack(delivery_tag=method.delivery_tag)\r\n        logging.info(f"\u2713 Treinamento {batch_id} conclu\xeddo: {model_version}")\r\n        \r\n    except Exception as e:\r\n        logging.error(f"Erro no treinamento: {str(e)}")\r\n        \r\n        if job_id:\r\n            update_training_job_error(job_id, str(e))\r\n        \r\n        # NACK com requeue\r\n        ch.basic_nack(delivery_tag=method.delivery_tag, requeue=True)\r\n\r\n\r\ndef build_model(num_classes):\r\n    """Constr\xf3i modelo MobileNetV2 com transfer learning"""\r\n    \r\n    # Carregar base pr\xe9-treinada\r\n    base_model = keras.applications.MobileNetV2(\r\n        input_shape=(224, 224, 3),\r\n        include_top=False,\r\n        weights=\'imagenet\'\r\n    )\r\n    \r\n    # Congelar base inicialmente\r\n    base_model.trainable = False\r\n    \r\n    # Adicionar top layers\r\n    model = keras.Sequential([\r\n        keras.layers.Input(shape=(224, 224, 3)),\r\n        base_model,\r\n        keras.layers.GlobalAveragePooling2D(),\r\n        keras.layers.Dense(512, activation=\'relu\'),\r\n        keras.layers.Dropout(0.5),\r\n        keras.layers.Dense(num_classes, activation=\'softmax\')\r\n    ])\r\n    \r\n    return model\r\n\r\n\r\ndef prepare_data_generators(dataset_path, batch_size=32, validation_split=0.2):\r\n    """Prepara data generators com augmenta\xe7\xe3o"""\r\n    \r\n    train_datagen = keras.preprocessing.image.ImageDataGenerator(\r\n        rescale=1./255,\r\n        rotation_range=20,\r\n        width_shift_range=0.2,\r\n        height_shift_range=0.2,\r\n        horizontal_flip=True,\r\n        zoom_range=0.2,\r\n        fill_mode=\'nearest\'\r\n    )\r\n    \r\n    val_datagen = keras.preprocessing.image.ImageDataGenerator(\r\n        rescale=1./255\r\n    )\r\n    \r\n    train_gen = train_datagen.flow_from_directory(\r\n        dataset_path,\r\n        target_size=(224, 224),\r\n        batch_size=batch_size,\r\n        class_mode=\'categorical\',\r\n        subset=\'training\'\r\n    )\r\n    \r\n    val_gen = val_datagen.flow_from_directory(\r\n        dataset_path,\r\n        target_size=(224, 224),\r\n        batch_size=batch_size,\r\n        class_mode=\'categorical\',\r\n        subset=\'validation\'\r\n    )\r\n    \r\n    return train_gen, val_gen, train_gen.num_classes\r\n\r\n\r\nclass CustomMetricsCallback(keras.callbacks.Callback):\r\n    """Callback customizado para registrar m\xe9tricas"""\r\n    \r\n    def __init__(self, job_id):\r\n        super().__init__()\r\n        self.job_id = job_id\r\n    \r\n    def on_epoch_end(self, epoch, logs=None):\r\n        # Salvar m\xe9trica no banco\r\n        save_epoch_metrics(\r\n            self.job_id,\r\n            epoch,\r\n            logs\r\n        )\r\n\r\n\r\ndef main():\r\n    """Fun\xe7\xe3o principal - inicia consumer"""\r\n    connection = pika.BlockingConnection(pika.URLParameters(RABBITMQ_URL))\r\n    channel = connection.channel()\r\n    \r\n    channel.queue_declare(queue=INPUT_QUEUE, durable=True)\r\n    channel.basic_consume(\r\n        queue=INPUT_QUEUE,\r\n        on_message_callback=process_training_message,\r\n        auto_ack=False\r\n    )\r\n    \r\n    logging.info("[*] Aguardando mensagens de treinamento...")\r\n    channel.start_consuming()\r\n\r\n\r\nif __name__ == \'__main__\':\r\n    main()\n'})}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"-docker",children:"\ud83d\udc33 Docker"}),"\n",(0,i.jsx)(r.h3,{id:"dockerfile",children:"Dockerfile"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-dockerfile",children:'FROM tensorflow/tensorflow:latest-gpu\r\n\r\nWORKDIR /app\r\n\r\n# Depend\xeancias do sistema\r\nRUN apt-get update && apt-get install -y \\\r\n    postgresql-client \\\r\n    git \\\r\n    && rm -rf /var/lib/apt/lists/*\r\n\r\n# Copiar requirements\r\nCOPY requirements.txt .\r\nRUN pip install --no-cache-dir -r requirements.txt\r\n\r\n# Copiar c\xf3digo\r\nCOPY . .\r\n\r\n# Health check\r\nHEALTHCHECK --interval=60s --timeout=30s --start-period=10s --retries=3 \\\r\n    CMD python -c "import tensorflow; print(\'OK\')" || exit 1\r\n\r\n# Executar\r\nCMD ["python", "main.py"]\n'})}),"\n",(0,i.jsx)(r.h3,{id:"requirementstxt",children:"requirements.txt"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-txt",children:"tensorflow==2.14.0\r\nkeras==2.14.0\r\nnumpy==1.24.3\r\npandas==2.1.0\r\npillow==10.1.0\r\nopencv-python==4.8.1.78\r\nscikit-learn==1.3.2\r\npika==1.3.1\r\nminio==7.1.15\r\npsycopg2-binary==2.9.9\r\npython-dotenv==1.0.0\r\ntensorboard==2.14.0\r\nwandb==0.15.12\r\nmatplotlib==3.8.1\r\nrequests==2.31.0\n"})}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"-exemplo-de-fluxo-completo",children:"\ud83d\udcca Exemplo de Fluxo Completo"}),"\n",(0,i.jsx)(r.mermaid,{value:"sequenceDiagram\r\n    participant Augmentations as \ud83c\udfa8 Augmentations Service\r\n    participant RabbitMQ as \ud83d\udce8 RabbitMQ\r\n    participant Training as \ud83c\udf93 Training Service\r\n    participant MinIO as \ud83d\udce6 MinIO\r\n    participant PostgreSQL as \ud83d\udcbe PostgreSQL\r\n    participant TensorBoard as \ud83d\udcca TensorBoard\r\n\r\n    Augmentations->>RabbitMQ: Publish (9000 imagens aumentadas)\r\n    RabbitMQ->>Training: Delivery (batchId, totalImages)\r\n    \r\n    Training->>PostgreSQL: INSERT training_jobs (status: training)\r\n    Training->>MinIO: Download dataset (9000 imagens)\r\n    MinIO--\x3e>Training: Stream de imagens\r\n    \r\n    Training->>Training: Split train 80% val 20%\r\n    Training->>Training: Constr\xf3i MobileNetV2\r\n    \r\n    loop 30 epochs\r\n        Training->>Training: Phase 1: Feature extraction (10 ep)\r\n        Training->>Training: Phase 2: Fine-tuning (20 ep)\r\n        Training->>PostgreSQL: INSERT training_metrics (epoch, loss, accuracy)\r\n        Training->>TensorBoard: Log scalars\r\n    end\r\n    \r\n    Training->>Training: Avaliar no test set\r\n    Training->>Training: Calcula m\xe9tricas finais\r\n    Training->>Training: Salva model.h5\r\n    \r\n    Training->>MinIO: Upload model (v3_20251115)\r\n    MinIO--\x3e>Training: Uploaded OK\r\n    \r\n    Training->>PostgreSQL: UPDATE training_jobs (status: success, accuracy: 0.94)\r\n    Training->>RabbitMQ: Publish (ModelEvaluation fila)\r\n    Training->>RabbitMQ: ACK"}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"-performance",children:"\u26a1 Performance"}),"\n",(0,i.jsxs)(r.table,{children:[(0,i.jsx)(r.thead,{children:(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.th,{children:"M\xe9trica"}),(0,i.jsx)(r.th,{children:"Valor"})]})}),(0,i.jsxs)(r.tbody,{children:[(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.strong,{children:"Tempo de treinamento"})}),(0,i.jsx)(r.td,{children:"60-120 minutos"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.strong,{children:"Mem\xf3ria necess\xe1ria"})}),(0,i.jsx)(r.td,{children:"4-8GB (GPU)"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.strong,{children:"Throughput"})}),(0,i.jsx)(r.td,{children:"1 modelo/hora"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.strong,{children:"Acur\xe1cia final"})}),(0,i.jsx)(r.td,{children:"92-96%"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.strong,{children:"Tamanho do modelo"})}),(0,i.jsx)(r.td,{children:"50-100MB"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.strong,{children:"Tempo de infer\xeancia"})}),(0,i.jsx)(r.td,{children:"100-200ms"})]})]})]}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h2,{id:"-conclus\xe3o",children:"\ud83c\udfaf Conclus\xe3o"}),"\n",(0,i.jsxs)(r.p,{children:["O ",(0,i.jsx)(r.strong,{children:"OColecionadorTraining"})," \xe9 um servi\xe7o robusto e eficiente que:"]}),"\n",(0,i.jsxs)(r.p,{children:["\u2705 ",(0,i.jsx)(r.strong,{children:"Consome mensagens"})," de forma ass\xedncrona",(0,i.jsx)(r.br,{}),"\n","\u2705 ",(0,i.jsx)(r.strong,{children:"Treina modelos"})," com Transfer Learning",(0,i.jsx)(r.br,{}),"\n","\u2705 ",(0,i.jsx)(r.strong,{children:"Gerencia vers\xf5es"})," de modelos",(0,i.jsx)(r.br,{}),"\n","\u2705 ",(0,i.jsx)(r.strong,{children:"Registra m\xe9tricas"})," detalhadas",(0,i.jsx)(r.br,{}),"\n","\u2705 ",(0,i.jsx)(r.strong,{children:"Suporta GPU"})," para acelerar treinamento",(0,i.jsx)(r.br,{}),"\n","\u2705 ",(0,i.jsx)(r.strong,{children:"Integra com TensorBoard"})," para visualiza\xe7\xe3o",(0,i.jsx)(r.br,{}),"\n","\u2705 ",(0,i.jsx)(r.strong,{children:"Publica resultados"})," para fila de avalia\xe7\xe3o"]}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Tempo m\xe9dio: 60-120 minutos por modelo"})})]})}function m(n={}){const{wrapper:r}={...(0,s.R)(),...n.components};return r?(0,i.jsx)(r,{...n,children:(0,i.jsx)(c,{...n})}):c(n)}}}]);